var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,l=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,r=(e,t,a)=>new Promise(((s,n)=>{var o=e=>{try{r(a.next(e))}catch(t){n(t)}},l=e=>{try{r(a.throw(e))}catch(t){n(t)}},r=e=>e.done?s(e.value):Promise.resolve(e.value).then(o,l);r((a=a.apply(e,t)).next())}));import{_ as d,p as c,w as i,o as u,c as v,a as p,n as m,q as f,t as _,i as k,e as y,d as b,b as g,F as h,h as w,u as S,r as R,s as q,l as K,x,y as C,z as D,m as $,A as B,S as N,k as M,M as U}from"./index-DTKJt6HL.js";const A={class:"card"},F={class:"card-body"},I={class:"row mb-4"},V={class:"col-md-4"},H={class:"date-input"},L={class:"invalid-feedback","data-testid":"transaction-date-error"},E={class:"col-md-4"},P={class:"position-relative"},O={class:"stock-input-wrapper"},T=["onKeydown"],j={key:0,class:"selected-stock","data-testid":"selected-stock-info"},Y={class:"invalid-feedback","data-testid":"stock-code-error"},W={key:0,class:"stock-list","data-testid":"stock-search-list"},Q=["onClick","onMouseover","data-testid"],z={class:"col-md-4"},G={class:"invalid-feedback","data-testid":"transaction-code-error"},J={class:"row mb-4"},X={class:"col-md-4"},Z={class:"invalid-feedback","data-testid":"transaction-type-error"},ee={class:"mb-4"},te={class:"d-flex justify-content-between align-items-center mb-2"},ae={class:"border rounded p-3","data-testid":"transaction-details-container"},se=["data-testid"],ne={class:"col-md-5"},oe=["data-testid"],le=["onUpdate:modelValue","onKeydown","data-testid"],re={class:"col-md-5"},de=["data-testid"],ce=["onUpdate:modelValue","onKeydown","data-testid"],ie=["data-testid"],ue={class:"col-md-2 d-flex align-items-end"},ve=["onClick","disabled","data-testid"],pe={class:"mb-4"},me={class:"border rounded p-3","data-testid":"fees-container"},fe={class:"row g-3"},_e={class:"col-md-4"},ke={class:"col-md-4"},ye={class:"col-md-4"},be={class:"col-md-4"},ge={class:"col-md-4"},he={class:"d-flex justify-content-end gap-2"},we=["disabled"],Se={key:0,class:"spinner-border spinner-border-sm me-1"},Re=["disabled"],qe={key:0,class:"spinner-border spinner-border-sm me-1"},Ke={class:"modal fade",id:"addStockModal",tabindex:"-1",ref:"addStockModal","data-testid":"add-stock-modal"},xe={class:"modal-dialog"},Ce={class:"modal-content"},De={class:"modal-body"},$e={class:"mb-3"},Be=["onKeydown"],Ne={class:"invalid-feedback","data-testid":"new-stock-code-error"},Me={class:"mb-3"},Ue={class:"invalid-feedback","data-testid":"new-stock-market-error"},Ae={class:"mb-3"},Fe={class:"invalid-feedback","data-testid":"new-stock-name-error"},Ie={class:"mb-3"},Ve={class:"mb-3"},He=["value"],Le={class:"modal-footer"},Ee=["disabled"],Pe={key:0,class:"spinner-border spinner-border-sm me-1"};const Oe=d({__name:"TransactionAdd",setup(e,{expose:d}){d();const c=S(),i=B(),u=R(!1),v=R(!1),p=R({transaction_date:"",stock_code:"",stock_name:"",transaction_code:"",transaction_type:"",details:[{quantity:null,price:null}],broker_fee:"",transaction_levy:"",stamp_duty:"",trading_fee:"",deposit_fee:"",market:"HK"}),m=R(!1),f=R({}),_={transaction_date:R(null),stock_code:R(null),transaction_code:R(null),transaction_type:R(null),broker_fee:R(null),transaction_levy:R(null),stamp_duty:R(null),trading_fee:R(null),deposit_fee:R(null),cancelBtn:R(null),saveBtn:R(null),saveAndAddBtn:R(null),addDetailBtn:R(null),quantityRefs:[],priceRefs:[]},k=R(!1),y=R([]),b=R(-1),g=R(null),h=R({market:"HK",code:"",name:"",full_name:"",current_price:null,alertMessage:""}),w=R(!1),A=()=>{p.value.details.push({quantity:null,price:null})},F=e=>{const t=new Date(e);return t instanceof Date&&!isNaN(t)},I=e=>{const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`},V=()=>{f.value={};let e=!0;return p.value.transaction_date&&F(p.value.transaction_date)||(f.value.transaction_date="请输入有效的交易日期",e=!1),p.value.stock_code||(f.value.stock_code="请选择股票",e=!1),p.value.transaction_code||(f.value.transaction_code="请输入交易编号",e=!1),p.value.transaction_type||(f.value.transaction_type="请选择交易类型",e=!1),p.value.details.forEach(((t,a)=>{const s=parseFloat(t.price);(isNaN(s)||s<=0)&&(f.value[`price_${a}`]="请输入有效的价格",e=!1);const n=parseFloat(t.quantity);(isNaN(n)||n<=0)&&(f.value[`quantity_${a}`]="请输入有效的数量",e=!1)})),e};q((()=>p.value.transaction_type),(()=>{"buy"===p.value.transaction_type&&(p.value.stamp_duty="")}));const H=e=>{e&&e.code&&$.get(`/api/stock/stocks/search?query=${encodeURIComponent(e.code)}`).then((t=>{if(t.data.success&&t.data.data.length>0){const a=t.data.data.find((t=>t.code===e.code));a?(p.value.stock_code=a.code,p.value.stock_name=a.name||"",p.value.market=a.market||"HK",m.value=!0):(i.warning("该股票可能已被删除，请重新选择"),p.value.stock_code="",p.value.stock_name="",m.value=!1)}})).catch((e=>{console.error("验证股票失败:",e),i.error("验证股票失败，请重新选择")})),setTimeout((()=>{k.value=!1,y.value=[],b.value=-1}),100)},L=()=>r(this,null,(function*(){var e,t;try{if(!V()||u.value)return;u.value=!0;const e=p.value.details.reduce(((e,t)=>e+(parseFloat(t.quantity)||0)),0),t=p.value.details.reduce(((e,t)=>e+(parseFloat(t.quantity)||0)*(parseFloat(t.price)||0)),0),a={transaction_date:p.value.transaction_date,stock_code:p.value.stock_code,market:p.value.market,transaction_type:p.value.transaction_type.toLowerCase(),transaction_code:p.value.transaction_code,details:p.value.details.map((e=>({quantity:parseFloat(e.quantity)||0,price:parseFloat(e.price)||0}))),total_quantity:e,total_amount:t,broker_fee:parseFloat(p.value.broker_fee)||0,transaction_levy:parseFloat(p.value.transaction_levy)||0,stamp_duty:parseFloat(p.value.stamp_duty)||0,trading_fee:parseFloat(p.value.trading_fee)||0,deposit_fee:parseFloat(p.value.deposit_fee)||0};console.log("提交的交易数据:",a),console.log("表单原始数据:",p.value);const s=yield $.post("/api/stock/transactions",a);if(!s.data.success)throw new Error(s.data.message||"操作失败");v.value?(E(),v.value=!1,i.success("交易记录添加成功"),yield x(),_.transaction_date.value&&_.transaction_date.value.focus()):(i.success("交易记录添加成功"),c.push("/transactions"))}catch(a){i.error((null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||a.message||"操作失败，请稍后重试")}finally{u.value=!1}})),E=()=>{p.value={transaction_date:"",stock_code:"",stock_name:"",transaction_code:"",transaction_type:"",details:[{quantity:null,price:null}],broker_fee:"",transaction_levy:"",stamp_duty:"",trading_fee:"",deposit_fee:"",market:"HK"},f.value={},m.value=!1};K((()=>{var e;x((()=>{console.log("检查所有输入框的 ref 是否绑定成功:",{transaction_date:_.transaction_date.value,stock_code:_.stock_code.value,transaction_code:_.transaction_code.value,transaction_type:_.transaction_type.value,broker_fee:_.broker_fee.value,transaction_levy:_.transaction_levy.value,stamp_duty:_.stamp_duty.value,trading_fee:_.trading_fee.value,deposit_fee:_.deposit_fee.value,cancelBtn:_.cancelBtn.value,saveBtn:_.saveBtn.value,saveAndAddBtn:_.saveAndAddBtn.value,addDetailBtn:_.addDetailBtn.value,quantityRefs:_.quantityRefs,priceRefs:_.priceRefs}),console.log("动态数组长度检查:",{details_length:p.value.details.length,quantityRefs_length:_.quantityRefs.length,priceRefs_length:_.priceRefs.length});const e=document.querySelectorAll("input:not([disabled]), button:not([disabled])");console.log("可聚焦元素数量:",e.length),p.value.details.forEach(((e,t)=>{console.log(`第 ${t+1} 行明细的ref:`,{quantity:_.quantityRefs[t],price:_.priceRefs[t]})}))})),document.addEventListener("click",T),null==(e=g.value)||e.addEventListener("hidden.bs.modal",(()=>{h.value={market:"HK",code:"",name:"",full_name:"",current_price:null,alertMessage:""}}))})),C((()=>{document.removeEventListener("click",T)}));q((()=>p.value.details.length),(e=>{x((()=>{_.quantityRefs||(_.quantityRefs=[]),_.priceRefs||(_.priceRefs=[]),_.quantityRefs.length=e,_.priceRefs.length=e;for(let t=0;t<e;t++)_.quantityRefs[t]||(_.quantityRefs[t]=null),_.priceRefs[t]||(_.priceRefs[t]=null)}))}));const P=D.debounce((e=>r(this,null,(function*(){const t=e.target.value.trim();if(!t)return k.value=!1,void(y.value=[]);try{const e=yield $.get(`/api/stock/stocks/search?query=${encodeURIComponent(t)}`,{params:{timestamp:(new Date).getTime()}});e.data.success&&Array.isArray(e.data.data)?(y.value=e.data.data,k.value=y.value.length>0,b.value=-1,0===y.value.length&&i.info("未找到匹配的股票")):(y.value=[],k.value=!1,i.warning("获取股票列表失败"))}catch(a){console.error("搜索股票失败:",a),y.value=[],k.value=!1,i.error("搜索股票失败，请重试")}}))),300),O=()=>{k.value=!1,b.value=-1},T=e=>{e.target.closest(".position-relative")||O()};q((()=>p.value.stock_code),(e=>{e||(p.value.stock_name="",p.value.market="HK",m.value=!1)}));const j=()=>{const e=h.value.code;h.value={market:"",code:e,name:"",google_code:"",current_price:null,alertMessage:""},f.value={}},Y={router:c,message:i,submitting:u,saveAndAddNext:v,form:p,stockSelected:m,errors:f,inputRefs:_,showStockList:k,filteredStocks:y,currentStockIndex:b,addStockModal:g,newStock:h,submittingStock:w,addDetail:A,removeDetail:e=>{p.value.details.length>1&&p.value.details.splice(e,1)},isValidDate:F,formatDate:I,handleDateInput:e=>{const t=e.target.value;p.value.transaction_date=t},handleDateBlur:e=>{const t=e.target.value.trim();if(!t)return void(p.value.transaction_date="");let a=null;if(/^\d{1,2}$/.test(t)){const e=t.padStart(2,"0"),s=new Date;a=`${s.getFullYear()}-${(s.getMonth()+1).toString().padStart(2,"0")}-${e}`}else if(/^\d{1,2}-\d{1,2}$/.test(t)){const[e,s]=t.split("-").map((e=>e.padStart(2,"0")));a=`${(new Date).getFullYear()}-${e}-${s}`}else if(/^\d{1,2}-\d{1,2}-\d{2}$/.test(t)){const[e,s,n]=t.split("-").map((e=>e.padStart(2,"0")));a=`20${n}-${e}-${s}`}else{const e=new Date(t);F(e)&&(a=I(e))}a&&F(a)?(p.value.transaction_date=a,delete f.value.transaction_date):f.value.transaction_date="请输入有效的交易日期"},validateForm:V,handleTransactionCodeInput:e=>{const t=e.target.value.toUpperCase();p.value.transaction_code=t,t.startsWith("P")?p.value.transaction_type="buy":t.startsWith("S")&&(p.value.transaction_type="sell")},handleTransactionCodeBlur:e=>r(this,null,(function*(){const t=p.value.transaction_code.trim();if(t)try{(yield $.get(`/api/stock/transactions/check-code?code=${encodeURIComponent(t)}`)).data.exists?(f.value.transaction_code="交易编号已存在，请重新输入",e.target.focus()):delete f.value.transaction_code}catch(a){console.error("检查交易编号失败:",a),i.error("检查交易编号失败，请重试")}})),handleStockSelect:()=>{if(k.value&&y.value.length>0){const e=b.value>=0&&b.value<y.value.length?y.value[b.value]:y.value[0];H(e)}},selectStock:H,submitForm:L,saveAndAdd:()=>{v.value=!0,L()},resetForm:E,setQuantityRef:(e,t)=>{for(_.quantityRefs||(_.quantityRefs=[]);_.quantityRefs.length<=t;)_.quantityRefs.push(null);_.quantityRefs[t]=e},setPriceRef:(e,t)=>{for(_.priceRefs||(_.priceRefs=[]);_.priceRefs.length<=t;)_.priceRefs.push(null);_.priceRefs[t]=e},handleKeyNavigation:(e,t)=>{if("Enter"===e.key){if(e.preventDefault(),t.startsWith("quantity_")){const e=parseInt(t.split("_")[1]),a=_.priceRefs[e];return void(a&&a.focus())}if(t.startsWith("price_")){if(parseInt(t.split("_")[1])===p.value.details.length-1){const e=_.broker_fee.value;e&&e.focus()}return}const a={transaction_date:()=>{var e;return null==(e=_.stock_code.value)?void 0:e.focus()},stock_code:()=>{var e;return null==(e=_.transaction_code.value)?void 0:e.focus()},transaction_code:()=>{const e=_.quantityRefs[0];e&&e.focus()},broker_fee:()=>{var e;return null==(e=_.transaction_levy.value)?void 0:e.focus()},transaction_levy:()=>{var e;return null==(e=_.stamp_duty.value)?void 0:e.focus()},stamp_duty:()=>{var e;return null==(e=_.trading_fee.value)?void 0:e.focus()},trading_fee:()=>{var e;return null==(e=_.deposit_fee.value)?void 0:e.focus()},deposit_fee:()=>{const e=_.saveAndAddBtn.value;e&&e.click()}}[t];a&&a()}if("Tab"===e.key){if(e.preventDefault(),t.startsWith("quantity_")){const e=parseInt(t.split("_")[1]),a=_.priceRefs[e];return void(a&&a.focus())}if(t.startsWith("price_"))return A(),void x((()=>{const e=p.value.details.length-1,t=_.quantityRefs[e];t&&t.focus()}));const a={transaction_date:()=>{var e;return null==(e=_.stock_code.value)?void 0:e.focus()},stock_code:()=>{var e;return null==(e=_.transaction_code.value)?void 0:e.focus()},transaction_code:()=>{const e=_.quantityRefs[0];e&&e.focus()},broker_fee:()=>{var e;return null==(e=_.transaction_levy.value)?void 0:e.focus()},transaction_levy:()=>{var e;return null==(e=_.stamp_duty.value)?void 0:e.focus()},stamp_duty:()=>{var e;return null==(e=_.trading_fee.value)?void 0:e.focus()},trading_fee:()=>{var e;return null==(e=_.deposit_fee.value)?void 0:e.focus()},deposit_fee:()=>{var e;return null==(e=_.cancelBtn.value)?void 0:e.focus()}}[t];a&&a()}},handleStockCodeInput:P,navigateStockList:e=>{k.value&&0!==y.value.length&&(b.value="up"===e?b.value<=0?y.value.length-1:b.value-1:b.value>=y.value.length-1?0:b.value+1)},closeStockList:O,handleClickOutside:T,handleStockCodeBlur:e=>r(this,null,(function*(){setTimeout((()=>r(this,null,(function*(){const e=p.value.stock_code;if(e){if(!m.value||!p.value.stock_name)try{const t=yield $.get(`/api/stock/stocks/search?query=${encodeURIComponent(e)}`);if(t.data.success&&Array.isArray(t.data.data)){const a=t.data.data.find((t=>t.code===e));if(a)return p.value.stock_code=a.code,p.value.stock_name=a.name,p.value.market=a.market,void(m.value=!0)}const a=yield $.get(`/api/stock/search_stock?code=${encodeURIComponent(e)}`);if(a.data.success&&a.data.data.length>0){const e=a.data.data[0];h.value={market:"HK"===e.market||"HKG"===e.exchange?"HK":"USA",code:e.code,name:e.code_name||"",google_code:e.query,current_price:e.price,alertMessage:""};new U(g.value).show()}else{h.value={market:"HK",code:e,name:"",google_code:"",current_price:null,alertMessage:"未找到股票信息，请手动输入股票详情"};new U(g.value).show()}}catch(t){console.error("搜索股票失败:",t),h.value={market:"HK",code:e,name:"",google_code:"",current_price:null,alertMessage:"搜索股票失败，请手动输入股票详情"};new U(g.value).show()}}else m.value=!1}))),200)})),handleNewStockCodeEnter:e=>r(this,null,(function*(){if(e.preventDefault(),h.value.code){f.value={},h.value.alertMessage="";try{const e=yield $.get(`/api/stock/search_stock?code=${encodeURIComponent(h.value.code)}`);if(e.data.success&&e.data.data.length>0){const c=e.data.data[0],i=yield $.get("/api/stock/stocks",{params:{search:c.code}});if(i.data.success&&i.data.data.items.length>0){const e=i.data.data.items.find((e=>e.code===c.code));if(e)return h.value=(r=((e,t)=>{for(var a in t||(t={}))n.call(t,a)&&l(e,a,t[a]);if(s)for(var a of s(t))o.call(t,a)&&l(e,a,t[a]);return e})({},e),d={current_price:c.price},t(r,a(d))),void(m.value=!0)}h.value={code:c.code,market:c.market,name:c.code_name||"",google_code:c.query,current_price:c.price},h.value.name&&(m.value=!0),h.value.name||(f.value.name="未能获取公司名称")}else h.value.alertMessage="未找到股票信息，请检查股票代码是否正确",j()}catch(c){console.error("查询股票信息失败:",c),h.value.alertMessage="查询失败，请检查股票代码是否正确",j()}var r,d}})),resetNewStockExceptCode:j,submitNewStock:()=>r(this,null,(function*(){var e,t;if(w.value)return;f.value={};let a=!0;if(h.value.code||(f.value.code="请输入股票代码",a=!1),h.value.market||(f.value.market="无法确定股票市场",a=!1),h.value.name||(f.value.name="未能获取股票名称",a=!1),h.value.current_price||(f.value.code="未能获取股票价格，请确认股票代码是否正确",a=!1),a)try{w.value=!0;const e=yield $.get("/api/stock/stocks",{params:{search:h.value.code}});if(e.data.success&&e.data.data.items.length>0){if(e.data.data.items.find((e=>e.code===h.value.code)))return i.warning("该股票代码已存在"),h.value.current_price=null,void(w.value=!1)}const t={code:h.value.code,market:h.value.market,code_name:h.value.name,google_name:h.value.google_code,currency:"HK"===h.value.market?"HKD":"USD"};console.log("提交的股票数据:",t);const a=yield $.post("/api/stock/stocks",t);if(a.data.success){i.success("股票添加成功"),p.value.stock_code=h.value.code,p.value.stock_name=h.value.name,p.value.market=h.value.market;try{if(g.value){const e=U.getInstance(g.value);if(e)e.hide();else{g.value.classList.remove("show"),g.value.style.display="none",document.body.classList.remove("modal-open");const e=document.querySelector(".modal-backdrop");e&&e.parentNode&&e.parentNode.removeChild(e)}}}catch(s){console.error("关闭模态框失败:",s)}h.value={market:"HK",code:"",name:"",full_name:"",current_price:null,alertMessage:""}}else i.error(a.data.message||"添加股票失败"),h.value.current_price=null}catch(n){i.error((null==(t=null==(e=n.response)?void 0:e.data)?void 0:t.message)||n.message||"添加股票失败，请重试"),h.value.current_price=null}finally{w.value=!1}})),handleStockCodeFocus:()=>{p.value.stock_code=""},ref:R,computed:M,watch:q,onMounted:K,nextTick:x,onBeforeUnmount:C,get useRouter(){return S},StockSelector:N,get axios(){return $},get useMessage(){return B},get debounce(){return D.debounce},get Modal(){return U}};return Object.defineProperty(Y,"__isScriptSetup",{enumerable:!1,value:!0}),Y}},[["render",function(e,t,a,s,n,o){const l=c("permission");return i((u(),v("div",A,[t[47]||(t[47]=p("div",{class:"card-header"},[p("h5",{class:"mb-0","data-testid":"transaction-add-title"},"添加交易记录")],-1)),p("div",F,[p("div",I,[p("div",V,[t[26]||(t[26]=p("label",{class:"form-label","data-testid":"transaction-date-label"},"交易日期",-1)),p("div",H,[i(p("input",{type:"text",class:m(["form-control",{"is-invalid":s.errors.transaction_date}]),"onUpdate:modelValue":t[0]||(t[0]=e=>s.form.transaction_date=e),onBlur:s.handleDateBlur,onKeydown:t[1]||(t[1]=e=>s.handleKeyNavigation(e,"transaction_date")),placeholder:"YYYY-MM-DD",ref:e=>s.inputRefs.transaction_date.value=e,"data-testid":"transaction-date-input"},null,34),[[f,s.form.transaction_date]]),p("div",L,_(s.errors.transaction_date),1)])]),p("div",E,[t[27]||(t[27]=p("label",{class:"form-label","data-testid":"stock-code-label"},"股票代码",-1)),p("div",P,[p("div",O,[i(p("input",{type:"text",class:m(["form-control",{"is-invalid":s.errors.stock_code}]),"onUpdate:modelValue":t[2]||(t[2]=e=>s.form.stock_code=e),ref:e=>s.inputRefs.stock_code.value=e,onInput:t[3]||(t[3]=(...e)=>s.handleStockCodeInput&&s.handleStockCodeInput(...e)),onBlur:s.handleStockCodeBlur,onFocus:s.handleStockCodeFocus,onKeydown:[t[4]||(t[4]=e=>s.handleKeyNavigation(e,"stock_code")),t[5]||(t[5]=y(b((e=>s.navigateStockList("down")),["prevent"]),["down"])),t[6]||(t[6]=y(b((e=>s.navigateStockList("up")),["prevent"]),["up"])),y(b(s.handleStockSelect,["prevent"]),["enter"]),y(s.closeStockList,["esc"])],placeholder:"输入代码或名称搜索","data-testid":"stock-code-input"},null,42,T),[[f,s.form.stock_code]]),s.form.stock_code&&s.form.stock_name?(u(),v("span",j,[p("span",{class:m(["market-tag","HK"===s.form.market?"hk":"usa"]),"data-testid":"selected-stock-market"},_(s.form.market),3),g(" "+_(s.form.stock_code)+" "+_(s.form.stock_name),1)])):k("",!0)]),p("div",Y,_(s.errors.stock_code),1),s.showStockList&&s.filteredStocks.length>0?(u(),v("div",W,[(u(!0),v(h,null,w(s.filteredStocks,((e,t)=>(u(),v("a",{key:e.code,href:"#",class:m(["stock-item",{active:t===s.currentStockIndex}]),onClick:b((t=>s.selectStock(e)),["prevent"]),onMouseover:e=>s.currentStockIndex=t,"data-testid":"stock-item-"+e.code},[p("span",{class:m(["market-tag","HK"===e.market?"hk":"usa"])},_(e.market),3),g(" "+_(e.code)+" - "+_(e.name),1)],42,Q)))),128))])):k("",!0)])]),p("div",z,[t[28]||(t[28]=p("label",{class:"form-label","data-testid":"transaction-code-label"},"交易编号",-1)),i(p("input",{type:"text",class:m(["form-control",{"is-invalid":s.errors.transaction_code}]),"onUpdate:modelValue":t[7]||(t[7]=e=>s.form.transaction_code=e),ref:e=>s.inputRefs.transaction_code.value=e,onInput:s.handleTransactionCodeInput,onBlur:s.handleTransactionCodeBlur,onKeydown:t[8]||(t[8]=e=>s.handleKeyNavigation(e,"transaction_code")),"data-testid":"transaction-code-input"},null,34),[[f,s.form.transaction_code]]),p("div",G,_(s.errors.transaction_code),1)])]),p("div",J,[p("div",X,[t[29]||(t[29]=p("label",{class:"form-label","data-testid":"transaction-type-label"},"交易类型",-1)),i(p("input",{type:"text",class:m(["form-control",{"is-invalid":s.errors.transaction_type}]),"onUpdate:modelValue":t[9]||(t[9]=e=>s.form.transaction_type=e),ref:e=>s.inputRefs.transaction_type.value=e,onKeydown:t[10]||(t[10]=e=>s.handleKeyNavigation(e,"transaction_type")),placeholder:"P-买入 S-卖出","data-testid":"transaction-type-input"},null,34),[[f,s.form.transaction_type]]),p("div",Z,_(s.errors.transaction_type),1)])]),p("div",ee,[p("div",te,[t[30]||(t[30]=p("label",{class:"form-label mb-0","data-testid":"transaction-details-label"},"成交明细",-1)),p("button",{type:"button",class:"btn btn-sm btn-outline-primary",onClick:s.addDetail,ref:e=>s.inputRefs.addDetailBtn.value=e,"data-testid":"add-detail-button"}," 添加成交记录 ",512)]),p("div",ae,[(u(!0),v(h,null,w(s.form.details,((e,t)=>(u(),v("div",{key:t,class:"row g-2 mb-2","data-testid":"detail-row-"+t},[p("div",ne,[p("label",{class:"form-label","data-testid":"quantity-label-"+t},"数量",8,oe),i(p("input",{type:"text",class:"form-control","onUpdate:modelValue":t=>e.quantity=t,ref_for:!0,ref:e=>s.setQuantityRef(e,t),onKeydown:e=>s.handleKeyNavigation(e,`quantity_${t}`),"data-testid":"quantity-input-"+t},null,40,le),[[f,e.quantity]])]),p("div",re,[p("label",{class:"form-label","data-testid":"price-label-"+t},"价格",8,de),i(p("input",{type:"text",class:m(["form-control",{"is-invalid":s.errors[`price_${t}`]}]),"onUpdate:modelValue":t=>e.price=t,ref_for:!0,ref:e=>s.setPriceRef(e,t),onKeydown:e=>s.handleKeyNavigation(e,`price_${t}`),"data-testid":"price-input-"+t},null,42,ce),[[f,e.price]]),p("div",{class:"invalid-feedback","data-testid":"price-error-"+t},_(s.errors[`price_${t}`]),9,ie)]),p("div",ue,[p("button",{type:"button",class:"btn btn-outline-danger w-100",onClick:e=>s.removeDetail(t),disabled:1===s.form.details.length,"data-testid":"remove-detail-button-"+t}," 删除 ",8,ve)])],8,se)))),128))])]),p("div",pe,[t[36]||(t[36]=p("label",{class:"form-label","data-testid":"fees-label"},"费用明细",-1)),p("div",me,[p("div",fe,[p("div",_e,[t[31]||(t[31]=p("label",{class:"form-label","data-testid":"broker-fee-label"},"经纪佣金",-1)),i(p("input",{type:"text",class:"form-control","onUpdate:modelValue":t[11]||(t[11]=e=>s.form.broker_fee=e),ref:e=>s.inputRefs.broker_fee.value=e,onKeydown:t[12]||(t[12]=e=>s.handleKeyNavigation(e,"broker_fee")),"data-testid":"broker-fee-input"},null,544),[[f,s.form.broker_fee]])]),p("div",ke,[t[32]||(t[32]=p("label",{class:"form-label","data-testid":"transaction-levy-label"},"交易征费",-1)),i(p("input",{type:"text",class:"form-control","onUpdate:modelValue":t[13]||(t[13]=e=>s.form.transaction_levy=e),ref:e=>s.inputRefs.transaction_levy.value=e,onKeydown:t[14]||(t[14]=e=>s.handleKeyNavigation(e,"transaction_levy")),"data-testid":"transaction-levy-input"},null,544),[[f,s.form.transaction_levy]])]),p("div",ye,[t[33]||(t[33]=p("label",{class:"form-label","data-testid":"stamp-duty-label"},"印花税",-1)),i(p("input",{type:"text",class:"form-control","onUpdate:modelValue":t[15]||(t[15]=e=>s.form.stamp_duty=e),ref:e=>s.inputRefs.stamp_duty.value=e,onKeydown:t[16]||(t[16]=e=>s.handleKeyNavigation(e,"stamp_duty")),"data-testid":"stamp-duty-input"},null,544),[[f,s.form.stamp_duty]])]),p("div",be,[t[34]||(t[34]=p("label",{class:"form-label","data-testid":"trading-fee-label"},"交易费",-1)),i(p("input",{type:"text",class:"form-control","onUpdate:modelValue":t[17]||(t[17]=e=>s.form.trading_fee=e),ref:e=>s.inputRefs.trading_fee.value=e,onKeydown:t[18]||(t[18]=e=>s.handleKeyNavigation(e,"trading_fee")),"data-testid":"trading-fee-input"},null,544),[[f,s.form.trading_fee]])]),p("div",ge,[t[35]||(t[35]=p("label",{class:"form-label","data-testid":"deposit-fee-label"},"存入证券费",-1)),i(p("input",{type:"text",class:"form-control","onUpdate:modelValue":t[19]||(t[19]=e=>s.form.deposit_fee=e),ref:e=>s.inputRefs.deposit_fee.value=e,onKeydown:t[20]||(t[20]=e=>s.handleKeyNavigation(e,"deposit_fee")),"data-testid":"deposit-fee-input"},null,544),[[f,s.form.deposit_fee]])])])])]),p("div",he,[p("button",{type:"button",class:"btn btn-secondary",onClick:t[21]||(t[21]=t=>e.$router.back()),ref:e=>s.inputRefs.cancelBtn.value=e,"data-testid":"cancel-button"}," 取消 ",512),p("button",{type:"button",class:"btn btn-primary",disabled:s.submitting,ref:e=>s.inputRefs.saveBtn.value=e,onClick:s.submitForm,"data-testid":"save-button"},[s.submitting?(u(),v("span",Se)):k("",!0),t[37]||(t[37]=g(" 保存 "))],8,we),p("button",{type:"button",class:"btn btn-success",disabled:s.submitting,onClick:s.saveAndAdd,ref:e=>s.inputRefs.saveAndAddBtn.value=e,"data-testid":"save-and-add-button"},[s.submitting?(u(),v("span",qe)):k("",!0),t[38]||(t[38]=g(" 保存并添加下一条 "))],8,Re)])]),p("div",Ke,[p("div",xe,[p("div",Ce,[t[46]||(t[46]=p("div",{class:"modal-header"},[p("h5",{class:"modal-title","data-testid":"add-stock-modal-title"},"添加新股票"),p("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","data-testid":"add-stock-modal-close"})],-1)),p("div",De,[p("form",{onSubmit:b(s.submitNewStock,["prevent"])},[p("div",$e,[t[39]||(t[39]=p("label",{class:"form-label","data-testid":"new-stock-code-label"},"股票代码",-1)),i(p("input",{type:"text",class:m(["form-control",{"is-invalid":s.errors.code}]),"onUpdate:modelValue":t[22]||(t[22]=e=>s.newStock.code=e),placeholder:"输入股票代码后将自动查询股票信息",onKeydown:[y(b(s.handleNewStockCodeEnter,["prevent"]),["enter"]),y(b(s.handleNewStockCodeEnter,["prevent"]),["tab"])],"data-testid":"new-stock-code-input"},null,42,Be),[[f,s.newStock.code]]),p("div",Ne,_(s.errors.code),1)]),p("div",Me,[t[40]||(t[40]=p("label",{class:"form-label","data-testid":"new-stock-market-label"},"市场",-1)),i(p("input",{type:"text",class:m(["form-control",{"is-invalid":s.errors.market}]),"onUpdate:modelValue":t[23]||(t[23]=e=>s.newStock.market=e),readonly:"","data-testid":"new-stock-market-input"},null,2),[[f,s.newStock.market]]),p("div",Ue,_(s.errors.market),1)]),p("div",Ae,[t[41]||(t[41]=p("label",{class:"form-label","data-testid":"new-stock-name-label"},"股票名称",-1)),i(p("input",{type:"text",class:m(["form-control",{"is-invalid":s.errors.name}]),"onUpdate:modelValue":t[24]||(t[24]=e=>s.newStock.name=e),readonly:"","data-testid":"new-stock-name-input"},null,2),[[f,s.newStock.name]]),p("div",Fe,_(s.errors.name),1)]),p("div",Ie,[t[42]||(t[42]=p("label",{class:"form-label","data-testid":"new-stock-google-code-label"},"谷歌查询代码",-1)),i(p("input",{type:"text",class:"form-control","onUpdate:modelValue":t[25]||(t[25]=e=>s.newStock.google_code=e),readonly:"","data-testid":"new-stock-google-code-input"},null,512),[[f,s.newStock.google_code]])]),p("div",Ve,[t[43]||(t[43]=p("label",{class:"form-label","data-testid":"new-stock-price-label"},"当前股价",-1)),p("input",{type:"text",class:"form-control",value:s.newStock.current_price,readonly:"","data-testid":"new-stock-price-input"},null,8,He),s.newStock.alertMessage?(u(),v("div",{key:0,class:m({"text-danger":s.newStock.alertMessage.includes("已存在"),"text-primary":s.newStock.alertMessage.includes("查询失败")}),"data-testid":"new-stock-alert-message"},_(s.newStock.alertMessage),3)):k("",!0)])],32)]),p("div",Le,[t[45]||(t[45]=p("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal","data-testid":"add-stock-modal-cancel"},"取消",-1)),p("button",{type:"button",class:"btn btn-primary",onClick:s.submitNewStock,disabled:s.submittingStock,"data-testid":"add-stock-modal-submit"},[s.submittingStock?(u(),v("span",Pe)):k("",!0),t[44]||(t[44]=g(" 确认添加 "))],8,Ee)])])])],512)])),[[l,"transaction:records:add"]])}],["__scopeId","data-v-1d36ba41"],["__file","TransactionAdd.vue"]]);export{Oe as default};
