var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,l=(t,a,o)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o,r=(e,t,a)=>new Promise(((o,s)=>{var n=e=>{try{r(a.next(e))}catch(t){s(t)}},l=e=>{try{r(a.throw(e))}catch(t){s(t)}},r=e=>e.done?o(e.value):Promise.resolve(e.value).then(n,l);r((a=a.apply(e,t)).next())}));import{_ as c,c as d,o as i,a as u,p as v,w as p,q as m,n as f,t as k,i as _,e as y,d as b,b as g,F as h,h as w,s as S,u as R,r as q,x as K,l as x,y as C,z as M,A as B,m as D,B as $,S as U,k as A,M as I}from"./index-DvBYsyF5.js";const N={class:"card"},F={class:"card-body"},V={class:"row mb-4"},E={class:"col-md-4"},L={class:"date-input"},H={class:"invalid-feedback","data-testid":"transaction-date-error"},T={class:"col-md-4"},P={class:"position-relative"},O={class:"stock-input-wrapper"},j=["onKeydown"],Y={key:0,class:"selected-stock","data-testid":"selected-stock-info"},W={class:"invalid-feedback","data-testid":"stock-code-error"},Q={key:0,class:"stock-list","data-testid":"stock-search-list"},z=["onClick","onMouseover","data-testid"],G={class:"col-md-4"},J={class:"invalid-feedback","data-testid":"transaction-code-error"},X={class:"row mb-4"},Z={class:"col-md-4"},ee={class:"invalid-feedback","data-testid":"transaction-type-error"},te={class:"mb-4"},ae={class:"d-flex justify-content-between align-items-center mb-2"},oe={class:"border rounded p-3","data-testid":"transaction-details-container"},se=["data-testid"],ne={class:"col-md-5"},le=["data-testid"],re=["onUpdate:modelValue","onKeydown","data-testid"],ce={class:"col-md-5"},de=["data-testid"],ie=["onUpdate:modelValue","onKeydown","data-testid"],ue=["data-testid"],ve={class:"col-md-2 d-flex align-items-end"},pe=["onClick","disabled","data-testid"],me={class:"mb-4"},fe={class:"border rounded p-3","data-testid":"fees-container"},ke={class:"row g-3"},_e={class:"col-md-4"},ye={class:"col-md-4"},be={class:"col-md-4"},ge={class:"col-md-4"},he={class:"col-md-4"},we={class:"d-flex justify-content-end gap-2"},Se=["disabled"],Re={key:0,class:"spinner-border spinner-border-sm me-1"},qe=["disabled"],Ke={key:0,class:"spinner-border spinner-border-sm me-1"},xe={class:"stock-modal"},Ce={class:"stock-modal-body","data-testid":"add-stock-modal"},Me={class:"mb-3"},Be=["onKeydown"],De={class:"invalid-feedback","data-testid":"new-stock-code-error"},$e={class:"mb-3"},Ue={class:"invalid-feedback","data-testid":"new-stock-market-error"},Ae={class:"mb-3"},Ie={class:"invalid-feedback","data-testid":"new-stock-name-error"},Ne={class:"mb-3"},Fe={class:"mb-3"},Ve=["value"],Ee={class:"stock-modal-footer"},Le=["disabled"],He={key:0,class:"spinner-border spinner-border-sm me-1"};const Te=c({__name:"TransactionAdd",setup(e,{expose:c}){c();const d=R(),i=$(),u=q(!1),v=q(!1),p=q({transaction_date:"",stock_code:"",stock_name:"",transaction_code:"",transaction_type:"",details:[{quantity:null,price:null}],broker_fee:"",transaction_levy:"",stamp_duty:"",trading_fee:"",deposit_fee:"",market:"HK",holder_id:1}),m=q(!1),f=q({}),k={transaction_date:q(null),stock_code:q(null),transaction_code:q(null),transaction_type:q(null),broker_fee:q(null),transaction_levy:q(null),stamp_duty:q(null),trading_fee:q(null),deposit_fee:q(null),cancelBtn:q(null),saveBtn:q(null),saveAndAddBtn:q(null),addDetailBtn:q(null),quantityRefs:[],priceRefs:[]},_=q(!1),y=q([]),b=q(-1),g=q(null),h=q(!1),w=q({market:"HK",code:"",name:"",full_name:"",current_price:null,alertMessage:""}),S=q(!1);let N=null;const F=()=>{try{if(g.value){const e=I.getInstance(g.value);e&&e.dispose(),N=new I(g.value,{backdrop:"static",keyboard:!0}),g.value.addEventListener("hidden.bs.modal",V)}}catch(e){console.error("初始化模态框失败:",e)}},V=()=>{document.querySelectorAll(".modal-backdrop").forEach((e=>{e.classList.remove("show"),setTimeout((()=>e.remove()),150)})),document.body.classList.remove("modal-open"),document.body.style.overflow="",document.body.style.paddingRight="",w.value={market:"HK",code:"",name:"",full_name:"",current_price:null,alertMessage:""}},E=()=>{p.value.details.push({quantity:null,price:null})},L=e=>{const t=new Date(e);return t instanceof Date&&!isNaN(t)},H=e=>{const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`},T=()=>{f.value={};let e=!0;return p.value.transaction_date&&L(p.value.transaction_date)||(f.value.transaction_date="请输入有效的交易日期",e=!1),p.value.stock_code||(f.value.stock_code="请选择股票",e=!1),p.value.transaction_code||(f.value.transaction_code="请输入交易编号",e=!1),p.value.transaction_type||(f.value.transaction_type="请选择交易类型",e=!1),p.value.details.forEach(((t,a)=>{const o=parseFloat(t.price);(isNaN(o)||o<=0)&&(f.value[`price_${a}`]="请输入有效的价格",e=!1);const s=parseFloat(t.quantity);(isNaN(s)||s<=0)&&(f.value[`quantity_${a}`]="请输入有效的数量",e=!1)})),e};K((()=>p.value.transaction_type),(()=>{"buy"===p.value.transaction_type&&(p.value.stamp_duty="")}));const P=e=>{e&&e.code&&D.get(`/api/stock/stocks/search?query=${encodeURIComponent(e.code)}`).then((t=>{if(t.data.success&&t.data.data.length>0){const a=t.data.data.find((t=>t.code===e.code));a?(p.value.stock_code=a.code,p.value.stock_name=a.name||"",p.value.market=a.market||"HK",m.value=!0):(i.warning("该股票可能已被删除，请重新选择"),p.value.stock_code="",p.value.stock_name="",m.value=!1)}})).catch((e=>{console.error("验证股票失败:",e),i.error("验证股票失败，请重新选择")})),setTimeout((()=>{_.value=!1,y.value=[],b.value=-1}),100)},O=()=>r(this,null,(function*(){var e,t;try{if(!T()||u.value)return;u.value=!0;const e=p.value.details.reduce(((e,t)=>e+(parseFloat(t.quantity)||0)),0),t=p.value.details.reduce(((e,t)=>e+(parseFloat(t.quantity)||0)*(parseFloat(t.price)||0)),0),a=e>0?t/e:0,o={transaction_date:p.value.transaction_date,stock_code:p.value.stock_code,market:p.value.market,transaction_type:p.value.transaction_type.toLowerCase(),transaction_code:p.value.transaction_code,details:p.value.details.map((e=>({quantity:parseFloat(e.quantity)||0,price:parseFloat(e.price)||0}))),total_quantity:e,total_amount:t,broker_fee:parseFloat(p.value.broker_fee)||0,transaction_levy:parseFloat(p.value.transaction_levy)||0,stamp_duty:parseFloat(p.value.stamp_duty)||0,trading_fee:parseFloat(p.value.trading_fee)||0,deposit_fee:parseFloat(p.value.deposit_fee)||0,holder_id:p.value.holder_id,avg_price:a};console.log("提交的交易数据:",o),console.log("表单原始数据:",p.value);const s=yield D.post("/api/stock/transactions",o);if(!s.data.success)throw new Error(s.data.message||"操作失败");v.value?(j(),v.value=!1,i.success("交易记录添加成功"),yield C(),k.transaction_date.value&&k.transaction_date.value.focus()):(i.success("交易记录添加成功"),d.push("/transactions"))}catch(a){i.error((null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||a.message||"操作失败，请稍后重试")}finally{u.value=!1}})),j=()=>{p.value={transaction_date:"",stock_code:"",stock_name:"",transaction_code:"",transaction_type:"",details:[{quantity:null,price:null}],broker_fee:"",transaction_levy:"",stamp_duty:"",trading_fee:"",deposit_fee:"",market:"HK",holder_id:1},f.value={},m.value=!1};x((()=>{C((()=>{console.log("检查所有输入框的 ref 是否绑定成功:",{transaction_date:k.transaction_date.value,stock_code:k.stock_code.value,transaction_code:k.transaction_code.value,transaction_type:k.transaction_type.value,broker_fee:k.broker_fee.value,transaction_levy:k.transaction_levy.value,stamp_duty:k.stamp_duty.value,trading_fee:k.trading_fee.value,deposit_fee:k.deposit_fee.value,cancelBtn:k.cancelBtn.value,saveBtn:k.saveBtn.value,saveAndAddBtn:k.saveAndAddBtn.value,addDetailBtn:k.addDetailBtn.value,quantityRefs:k.quantityRefs,priceRefs:k.priceRefs}),console.log("动态数组长度检查:",{details_length:p.value.details.length,quantityRefs_length:k.quantityRefs.length,priceRefs_length:k.priceRefs.length});const e=document.querySelectorAll("input:not([disabled]), button:not([disabled])");console.log("可聚焦元素数量:",e.length),p.value.details.forEach(((e,t)=>{console.log(`第 ${t+1} 行明细的ref:`,{quantity:k.quantityRefs[t],price:k.priceRefs[t]})}))})),document.addEventListener("click",Q),setTimeout(F,500),window.addEventListener("load",F)})),M((()=>{document.removeEventListener("click",Q),g.value&&g.value.removeEventListener("hidden.bs.modal",V),N&&N.dispose(),window.removeEventListener("load",F)}));K((()=>p.value.details.length),(e=>{C((()=>{k.quantityRefs||(k.quantityRefs=[]),k.priceRefs||(k.priceRefs=[]),k.quantityRefs.length=e,k.priceRefs.length=e;for(let t=0;t<e;t++)k.quantityRefs[t]||(k.quantityRefs[t]=null),k.priceRefs[t]||(k.priceRefs[t]=null)}))}));const Y=B.debounce((e=>r(this,null,(function*(){const t=e.target.value.trim();if(!t)return _.value=!1,void(y.value=[]);try{const e=yield D.get(`/api/stock/stocks/search?query=${encodeURIComponent(t)}`,{params:{timestamp:(new Date).getTime()}});e.data.success&&Array.isArray(e.data.data)?(y.value=e.data.data,_.value=y.value.length>0,b.value=-1,0===y.value.length&&i.info("未找到匹配的股票")):(y.value=[],_.value=!1,i.warning("获取股票列表失败"))}catch(a){console.error("搜索股票失败:",a),y.value=[],_.value=!1,i.error("搜索股票失败，请重试")}}))),300),W=()=>{_.value=!1,b.value=-1},Q=e=>{e.target.closest(".position-relative")||W()};K((()=>p.value.stock_code),(e=>{e||(p.value.stock_name="",p.value.market="HK",m.value=!1)}));const z=()=>{const e=w.value.code;w.value={market:"",code:e,name:"",google_code:"",current_price:null,alertMessage:""},f.value={}},G={router:d,message:i,submitting:u,saveAndAddNext:v,form:p,stockSelected:m,errors:f,inputRefs:k,showStockList:_,filteredStocks:y,currentStockIndex:b,addStockModal:g,showStockModal:h,newStock:w,submittingStock:S,get stockModalInstance(){return N},set stockModalInstance(e){N=e},initModal:F,cleanupModalEffects:V,addDetail:E,removeDetail:e=>{p.value.details.length>1&&p.value.details.splice(e,1)},isValidDate:L,formatDate:H,handleDateInput:e=>{const t=e.target.value;p.value.transaction_date=t},handleDateBlur:e=>{const t=e.target.value.trim();if(!t)return void(p.value.transaction_date="");let a=null;if(/^\d{1,2}$/.test(t)){const e=t.padStart(2,"0"),o=new Date;a=`${o.getFullYear()}-${(o.getMonth()+1).toString().padStart(2,"0")}-${e}`}else if(/^\d{1,2}-\d{1,2}$/.test(t)){const[e,o]=t.split("-").map((e=>e.padStart(2,"0")));a=`${(new Date).getFullYear()}-${e}-${o}`}else if(/^\d{1,2}-\d{1,2}-\d{2}$/.test(t)){const[e,o,s]=t.split("-").map((e=>e.padStart(2,"0")));a=`20${s}-${e}-${o}`}else{const e=new Date(t);L(e)&&(a=H(e))}a&&L(a)?(p.value.transaction_date=a,delete f.value.transaction_date):f.value.transaction_date="请输入有效的交易日期"},validateForm:T,handleTransactionCodeInput:e=>{const t=e.target.value.toUpperCase();p.value.transaction_code=t,t.startsWith("P")?p.value.transaction_type="buy":t.startsWith("S")&&(p.value.transaction_type="sell")},handleTransactionCodeBlur:e=>r(this,null,(function*(){const t=p.value.transaction_code.trim();if(t)try{(yield D.get(`/api/stock/transactions/check-code?code=${encodeURIComponent(t)}`)).data.exists?(f.value.transaction_code="交易编号已存在，请重新输入",e.target.focus()):delete f.value.transaction_code}catch(a){console.error("检查交易编号失败:",a),i.error("检查交易编号失败，请重试")}})),handleStockSelect:()=>{if(_.value&&y.value.length>0){const e=b.value>=0&&b.value<y.value.length?y.value[b.value]:y.value[0];P(e)}},selectStock:P,submitForm:O,saveAndAdd:()=>{v.value=!0,O()},resetForm:j,setQuantityRef:(e,t)=>{for(k.quantityRefs||(k.quantityRefs=[]);k.quantityRefs.length<=t;)k.quantityRefs.push(null);k.quantityRefs[t]=e},setPriceRef:(e,t)=>{for(k.priceRefs||(k.priceRefs=[]);k.priceRefs.length<=t;)k.priceRefs.push(null);k.priceRefs[t]=e},handleKeyNavigation:(e,t)=>{if("Enter"===e.key){if(e.preventDefault(),t.startsWith("quantity_")){const e=parseInt(t.split("_")[1]),a=k.priceRefs[e];return void(a&&a.focus())}if(t.startsWith("price_")){if(parseInt(t.split("_")[1])===p.value.details.length-1){const e=k.broker_fee.value;e&&e.focus()}return}const a={transaction_date:()=>{var e;return null==(e=k.stock_code.value)?void 0:e.focus()},stock_code:()=>{var e;return null==(e=k.transaction_code.value)?void 0:e.focus()},transaction_code:()=>{const e=k.quantityRefs[0];e&&e.focus()},broker_fee:()=>{var e;return null==(e=k.transaction_levy.value)?void 0:e.focus()},transaction_levy:()=>{var e;return null==(e=k.stamp_duty.value)?void 0:e.focus()},stamp_duty:()=>{var e;return null==(e=k.trading_fee.value)?void 0:e.focus()},trading_fee:()=>{var e;return null==(e=k.deposit_fee.value)?void 0:e.focus()},deposit_fee:()=>{const e=k.saveAndAddBtn.value;e&&e.click()}}[t];a&&a()}if("Tab"===e.key){if(e.preventDefault(),t.startsWith("quantity_")){const e=parseInt(t.split("_")[1]),a=k.priceRefs[e];return void(a&&a.focus())}if(t.startsWith("price_"))return E(),void C((()=>{const e=p.value.details.length-1,t=k.quantityRefs[e];t&&t.focus()}));const a={transaction_date:()=>{var e;return null==(e=k.stock_code.value)?void 0:e.focus()},stock_code:()=>{var e;return null==(e=k.transaction_code.value)?void 0:e.focus()},transaction_code:()=>{const e=k.quantityRefs[0];e&&e.focus()},broker_fee:()=>{var e;return null==(e=k.transaction_levy.value)?void 0:e.focus()},transaction_levy:()=>{var e;return null==(e=k.stamp_duty.value)?void 0:e.focus()},stamp_duty:()=>{var e;return null==(e=k.trading_fee.value)?void 0:e.focus()},trading_fee:()=>{var e;return null==(e=k.deposit_fee.value)?void 0:e.focus()},deposit_fee:()=>{var e;return null==(e=k.cancelBtn.value)?void 0:e.focus()}}[t];a&&a()}},handleStockCodeInput:Y,navigateStockList:e=>{_.value&&0!==y.value.length&&(b.value="up"===e?b.value<=0?y.value.length-1:b.value-1:b.value>=y.value.length-1?0:b.value+1)},closeStockList:W,handleClickOutside:Q,handleStockCodeBlur:e=>r(this,null,(function*(){setTimeout((()=>r(this,null,(function*(){const e=p.value.stock_code;if(e){if(!m.value||!p.value.stock_name)try{const t=yield D.get(`/api/stock/stocks/search?query=${encodeURIComponent(e)}`);if(t.data.success&&Array.isArray(t.data.data)){const a=t.data.data.find((t=>t.code===e));if(a)return p.value.stock_code=a.code,p.value.stock_name=a.name,p.value.market=a.market,void(m.value=!0)}const a=yield D.get(`/api/stock/search_stock?code=${encodeURIComponent(e)}`);if(a.data.success&&a.data.data.length>0){const e=a.data.data[0];w.value={market:"HK"===e.market||"HKG"===e.exchange?"HK":"USA",code:e.code,name:e.code_name||"",google_code:e.query,current_price:e.price,alertMessage:""},h.value=!0}else w.value={market:"HK",code:e,name:"",google_code:"",current_price:null,alertMessage:"未找到股票信息，请手动输入股票详情"},h.value=!0}catch(t){console.error("搜索股票失败:",t),w.value={market:"HK",code:e,name:"",google_code:"",current_price:null,alertMessage:"搜索股票失败，请手动输入股票详情"},h.value=!0}}else m.value=!1}))),200)})),handleNewStockCodeEnter:e=>r(this,null,(function*(){if(e.preventDefault(),w.value.code){f.value={},w.value.alertMessage="";try{const e=yield D.get(`/api/stock/search_stock?code=${encodeURIComponent(w.value.code)}`);if(e.data.success&&e.data.data.length>0){const d=e.data.data[0],i=yield D.get("/api/stock/stocks",{params:{search:d.code}});if(i.data.success&&i.data.data.items.length>0){const e=i.data.data.items.find((e=>e.code===d.code));if(e)return w.value=(r=((e,t)=>{for(var a in t||(t={}))s.call(t,a)&&l(e,a,t[a]);if(o)for(var a of o(t))n.call(t,a)&&l(e,a,t[a]);return e})({},e),c={current_price:d.price},t(r,a(c))),void(m.value=!0)}w.value={code:d.code,market:d.market,name:d.code_name||"",google_code:d.query,current_price:d.price},w.value.name&&(m.value=!0),w.value.name||(f.value.name="未能获取公司名称")}else w.value.alertMessage="未找到股票信息，请检查股票代码是否正确",z()}catch(d){console.error("查询股票信息失败:",d),w.value.alertMessage="查询失败，请检查股票代码是否正确",z()}var r,c}})),resetNewStockExceptCode:z,submitNewStock:()=>r(this,null,(function*(){var e,t;if(S.value)return;f.value={};let a=!0;if(w.value.code||(f.value.code="请输入股票代码",a=!1),w.value.market||(f.value.market="无法确定股票市场",a=!1),w.value.name||(f.value.name="未能获取股票名称",a=!1),w.value.current_price||(f.value.code="未能获取股票价格，请确认股票代码是否正确",a=!1),a)try{S.value=!0;const e=yield D.get("/api/stock/stocks",{params:{search:w.value.code}});if(e.data.success&&e.data.data.items.length>0){if(e.data.data.items.find((e=>e.code===w.value.code)))return i.warning("该股票代码已存在"),w.value.current_price=null,void(S.value=!1)}const t={code:w.value.code,market:w.value.market,code_name:w.value.name,google_name:w.value.google_code,currency:"HK"===w.value.market?"HKD":"USD"};console.log("提交的股票数据:",t);const a=yield D.post("/api/stock/stocks",t);a.data.success?(i.success("股票添加成功"),p.value.stock_code=w.value.code,p.value.stock_name=w.value.name,p.value.market=w.value.market,m.value=!0,h.value=!1):(i.error(a.data.message||"添加股票失败"),w.value.current_price=null)}catch(o){i.error((null==(t=null==(e=o.response)?void 0:e.data)?void 0:t.message)||o.message||"添加股票失败，请重试"),w.value.current_price=null}finally{S.value=!1}})),handleStockCodeFocus:()=>{p.value.stock_code=""},closeStockModal:()=>{h.value=!1,setTimeout((()=>{m.value||(p.value.stock_code="")}),100)},ref:q,computed:A,watch:K,onMounted:x,nextTick:C,onBeforeUnmount:M,get useRouter(){return R},StockSelector:U,get axios(){return D},get useMessage(){return $},get debounce(){return B.debounce},get Modal(){return I}};return Object.defineProperty(G,"__isScriptSetup",{enumerable:!1,value:!0}),G}},[["render",function(e,t,a,o,s,n){return i(),d("div",N,[t[46]||(t[46]=u("div",{class:"card-header"},[u("h5",{class:"mb-0","data-testid":"transaction-add-title"},"添加交易记录")],-1)),u("div",F,[u("div",V,[u("div",E,[t[26]||(t[26]=u("label",{class:"form-label","data-testid":"transaction-date-label"},"交易日期",-1)),u("div",L,[p(u("input",{type:"text",class:f(["form-control",{"is-invalid":o.errors.transaction_date}]),"onUpdate:modelValue":t[0]||(t[0]=e=>o.form.transaction_date=e),onBlur:o.handleDateBlur,onKeydown:t[1]||(t[1]=e=>o.handleKeyNavigation(e,"transaction_date")),placeholder:"YYYY-MM-DD",ref:e=>o.inputRefs.transaction_date.value=e,"data-testid":"transaction-date-input"},null,34),[[m,o.form.transaction_date]]),u("div",H,k(o.errors.transaction_date),1)])]),u("div",T,[t[27]||(t[27]=u("label",{class:"form-label","data-testid":"stock-code-label"},"股票代码",-1)),u("div",P,[u("div",O,[p(u("input",{type:"text",class:f(["form-control",{"is-invalid":o.errors.stock_code}]),"onUpdate:modelValue":t[2]||(t[2]=e=>o.form.stock_code=e),ref:e=>o.inputRefs.stock_code.value=e,onInput:t[3]||(t[3]=(...e)=>o.handleStockCodeInput&&o.handleStockCodeInput(...e)),onBlur:o.handleStockCodeBlur,onFocus:o.handleStockCodeFocus,onKeydown:[t[4]||(t[4]=e=>o.handleKeyNavigation(e,"stock_code")),t[5]||(t[5]=y(b((e=>o.navigateStockList("down")),["prevent"]),["down"])),t[6]||(t[6]=y(b((e=>o.navigateStockList("up")),["prevent"]),["up"])),y(b(o.handleStockSelect,["prevent"]),["enter"]),y(o.closeStockList,["esc"])],placeholder:"输入代码或名称搜索","data-testid":"stock-code-input"},null,42,j),[[m,o.form.stock_code]]),o.form.stock_code&&o.form.stock_name?(i(),d("span",Y,[u("span",{class:f(["market-tag","HK"===o.form.market?"hk":"usa"]),"data-testid":"selected-stock-market"},k(o.form.market),3),g(" "+k(o.form.stock_code)+" "+k(o.form.stock_name),1)])):_("",!0)]),u("div",W,k(o.errors.stock_code),1),o.showStockList&&o.filteredStocks.length>0?(i(),d("div",Q,[(i(!0),d(h,null,w(o.filteredStocks,((e,t)=>(i(),d("a",{key:e.code,href:"#",class:f(["stock-item",{active:t===o.currentStockIndex}]),onClick:b((t=>o.selectStock(e)),["prevent"]),onMouseover:e=>o.currentStockIndex=t,"data-testid":"stock-item-"+e.code},[u("span",{class:f(["market-tag","HK"===e.market?"hk":"usa"])},k(e.market),3),g(" "+k(e.code)+" - "+k(e.name),1)],42,z)))),128))])):_("",!0)])]),u("div",G,[t[28]||(t[28]=u("label",{class:"form-label","data-testid":"transaction-code-label"},"交易编号",-1)),p(u("input",{type:"text",class:f(["form-control",{"is-invalid":o.errors.transaction_code}]),"onUpdate:modelValue":t[7]||(t[7]=e=>o.form.transaction_code=e),ref:e=>o.inputRefs.transaction_code.value=e,onInput:o.handleTransactionCodeInput,onBlur:o.handleTransactionCodeBlur,onKeydown:t[8]||(t[8]=e=>o.handleKeyNavigation(e,"transaction_code")),"data-testid":"transaction-code-input"},null,34),[[m,o.form.transaction_code]]),u("div",J,k(o.errors.transaction_code),1)])]),u("div",X,[u("div",Z,[t[29]||(t[29]=u("label",{class:"form-label","data-testid":"transaction-type-label"},"交易类型",-1)),p(u("input",{type:"text",class:f(["form-control",{"is-invalid":o.errors.transaction_type}]),"onUpdate:modelValue":t[9]||(t[9]=e=>o.form.transaction_type=e),ref:e=>o.inputRefs.transaction_type.value=e,onKeydown:t[10]||(t[10]=e=>o.handleKeyNavigation(e,"transaction_type")),placeholder:"P-买入 S-卖出","data-testid":"transaction-type-input"},null,34),[[m,o.form.transaction_type]]),u("div",ee,k(o.errors.transaction_type),1)])]),u("div",te,[u("div",ae,[t[30]||(t[30]=u("label",{class:"form-label mb-0","data-testid":"transaction-details-label"},"成交明细",-1)),u("button",{type:"button",class:"btn btn-sm btn-outline-primary",onClick:o.addDetail,ref:e=>o.inputRefs.addDetailBtn.value=e,"data-testid":"add-detail-button"}," 添加成交记录 ",512)]),u("div",oe,[(i(!0),d(h,null,w(o.form.details,((e,t)=>(i(),d("div",{key:t,class:"row g-2 mb-2","data-testid":"detail-row-"+t},[u("div",ne,[u("label",{class:"form-label","data-testid":"quantity-label-"+t},"数量",8,le),p(u("input",{type:"text",class:"form-control","onUpdate:modelValue":t=>e.quantity=t,ref_for:!0,ref:e=>o.setQuantityRef(e,t),onKeydown:e=>o.handleKeyNavigation(e,`quantity_${t}`),"data-testid":"quantity-input-"+t},null,40,re),[[m,e.quantity]])]),u("div",ce,[u("label",{class:"form-label","data-testid":"price-label-"+t},"价格",8,de),p(u("input",{type:"text",class:f(["form-control",{"is-invalid":o.errors[`price_${t}`]}]),"onUpdate:modelValue":t=>e.price=t,ref_for:!0,ref:e=>o.setPriceRef(e,t),onKeydown:e=>o.handleKeyNavigation(e,`price_${t}`),"data-testid":"price-input-"+t},null,42,ie),[[m,e.price]]),u("div",{class:"invalid-feedback","data-testid":"price-error-"+t},k(o.errors[`price_${t}`]),9,ue)]),u("div",ve,[u("button",{type:"button",class:"btn btn-outline-danger w-100",onClick:e=>o.removeDetail(t),disabled:1===o.form.details.length,"data-testid":"remove-detail-button-"+t}," 删除 ",8,pe)])],8,se)))),128))])]),u("div",me,[t[36]||(t[36]=u("label",{class:"form-label","data-testid":"fees-label"},"费用明细",-1)),u("div",fe,[u("div",ke,[u("div",_e,[t[31]||(t[31]=u("label",{class:"form-label","data-testid":"broker-fee-label"},"经纪佣金",-1)),p(u("input",{type:"text",class:"form-control","onUpdate:modelValue":t[11]||(t[11]=e=>o.form.broker_fee=e),ref:e=>o.inputRefs.broker_fee.value=e,onKeydown:t[12]||(t[12]=e=>o.handleKeyNavigation(e,"broker_fee")),"data-testid":"broker-fee-input"},null,544),[[m,o.form.broker_fee]])]),u("div",ye,[t[32]||(t[32]=u("label",{class:"form-label","data-testid":"transaction-levy-label"},"交易征费",-1)),p(u("input",{type:"text",class:"form-control","onUpdate:modelValue":t[13]||(t[13]=e=>o.form.transaction_levy=e),ref:e=>o.inputRefs.transaction_levy.value=e,onKeydown:t[14]||(t[14]=e=>o.handleKeyNavigation(e,"transaction_levy")),"data-testid":"transaction-levy-input"},null,544),[[m,o.form.transaction_levy]])]),u("div",be,[t[33]||(t[33]=u("label",{class:"form-label","data-testid":"stamp-duty-label"},"印花税",-1)),p(u("input",{type:"text",class:"form-control","onUpdate:modelValue":t[15]||(t[15]=e=>o.form.stamp_duty=e),ref:e=>o.inputRefs.stamp_duty.value=e,onKeydown:t[16]||(t[16]=e=>o.handleKeyNavigation(e,"stamp_duty")),"data-testid":"stamp-duty-input"},null,544),[[m,o.form.stamp_duty]])]),u("div",ge,[t[34]||(t[34]=u("label",{class:"form-label","data-testid":"trading-fee-label"},"交易费",-1)),p(u("input",{type:"text",class:"form-control","onUpdate:modelValue":t[17]||(t[17]=e=>o.form.trading_fee=e),ref:e=>o.inputRefs.trading_fee.value=e,onKeydown:t[18]||(t[18]=e=>o.handleKeyNavigation(e,"trading_fee")),"data-testid":"trading-fee-input"},null,544),[[m,o.form.trading_fee]])]),u("div",he,[t[35]||(t[35]=u("label",{class:"form-label","data-testid":"deposit-fee-label"},"存入证券费",-1)),p(u("input",{type:"text",class:"form-control","onUpdate:modelValue":t[19]||(t[19]=e=>o.form.deposit_fee=e),ref:e=>o.inputRefs.deposit_fee.value=e,onKeydown:t[20]||(t[20]=e=>o.handleKeyNavigation(e,"deposit_fee")),"data-testid":"deposit-fee-input"},null,544),[[m,o.form.deposit_fee]])])])])]),u("div",we,[u("button",{type:"button",class:"btn btn-secondary",onClick:t[21]||(t[21]=t=>e.$router.back()),ref:e=>o.inputRefs.cancelBtn.value=e,"data-testid":"cancel-button"}," 取消 ",512),u("button",{type:"button",class:"btn btn-primary",disabled:o.submitting,ref:e=>o.inputRefs.saveBtn.value=e,onClick:o.submitForm,"data-testid":"save-button"},[o.submitting?(i(),d("span",Re)):_("",!0),t[37]||(t[37]=g(" 保存 "))],8,Se),u("button",{type:"button",class:"btn btn-success",disabled:o.submitting,onClick:o.saveAndAdd,ref:e=>o.inputRefs.saveAndAddBtn.value=e,"data-testid":"save-and-add-button"},[o.submitting?(i(),d("span",Ke)):_("",!0),t[38]||(t[38]=g(" 保存并添加下一条 "))],8,qe)])]),(i(),v(S,{to:"body"},[o.showStockModal?(i(),d("div",{key:0,class:"stock-modal-backdrop",onClick:b(o.closeStockModal,["self"])},[u("div",xe,[u("div",{class:"stock-modal-header"},[t[39]||(t[39]=u("h5",{class:"stock-modal-title","data-testid":"add-stock-modal-title"},"添加新股票",-1)),u("button",{type:"button",class:"stock-modal-close",onClick:o.closeStockModal},"×")]),u("div",Ce,[u("form",{onSubmit:b(o.submitNewStock,["prevent"])},[u("div",Me,[t[40]||(t[40]=u("label",{class:"form-label","data-testid":"new-stock-code-label"},"股票代码",-1)),p(u("input",{type:"text",class:f(["form-control",{"is-invalid":o.errors.code}]),"onUpdate:modelValue":t[22]||(t[22]=e=>o.newStock.code=e),placeholder:"输入股票代码后将自动查询股票信息",onKeydown:y(b(o.handleNewStockCodeEnter,["prevent"]),["enter"]),"data-testid":"new-stock-code-input"},null,42,Be),[[m,o.newStock.code]]),u("div",De,k(o.errors.code),1)]),u("div",$e,[t[41]||(t[41]=u("label",{class:"form-label","data-testid":"new-stock-market-label"},"市场",-1)),p(u("input",{type:"text",class:f(["form-control",{"is-invalid":o.errors.market}]),"onUpdate:modelValue":t[23]||(t[23]=e=>o.newStock.market=e),readonly:"","data-testid":"new-stock-market-input"},null,2),[[m,o.newStock.market]]),u("div",Ue,k(o.errors.market),1)]),u("div",Ae,[t[42]||(t[42]=u("label",{class:"form-label","data-testid":"new-stock-name-label"},"股票名称",-1)),p(u("input",{type:"text",class:f(["form-control",{"is-invalid":o.errors.name}]),"onUpdate:modelValue":t[24]||(t[24]=e=>o.newStock.name=e),readonly:"","data-testid":"new-stock-name-input"},null,2),[[m,o.newStock.name]]),u("div",Ie,k(o.errors.name),1)]),u("div",Ne,[t[43]||(t[43]=u("label",{class:"form-label","data-testid":"new-stock-google-code-label"},"谷歌查询代码",-1)),p(u("input",{type:"text",class:"form-control","onUpdate:modelValue":t[25]||(t[25]=e=>o.newStock.google_code=e),readonly:"","data-testid":"new-stock-google-code-input"},null,512),[[m,o.newStock.google_code]])]),u("div",Fe,[t[44]||(t[44]=u("label",{class:"form-label","data-testid":"new-stock-price-label"},"当前股价",-1)),u("input",{type:"text",class:"form-control",value:o.newStock.current_price,readonly:"","data-testid":"new-stock-price-input"},null,8,Ve),o.newStock.alertMessage?(i(),d("div",{key:0,class:f({"text-danger":o.newStock.alertMessage.includes("已存在"),"text-primary":o.newStock.alertMessage.includes("查询失败")}),"data-testid":"new-stock-alert-message"},k(o.newStock.alertMessage),3)):_("",!0)])],32)]),u("div",Ee,[u("button",{type:"button",class:"btn-secondary",onClick:o.closeStockModal,"data-testid":"add-stock-modal-cancel"},"取消"),u("button",{type:"button",class:"btn-primary",onClick:o.submitNewStock,disabled:o.submittingStock,"data-testid":"add-stock-modal-submit"},[o.submittingStock?(i(),d("span",He)):_("",!0),t[45]||(t[45]=g(" 确认添加 "))],8,Le)])])])):_("",!0)]))])}],["__scopeId","data-v-cbeccff8"],["__file","TransactionAdd.vue"]]);export{Te as default};
