var t=Object.defineProperty,e=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,l=(e,a,s)=>a in e?t(e,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[a]=s,o=(t,o)=>{for(var r in o||(o={}))a.call(o,r)&&l(t,r,o[r]);if(e)for(var r of e(o))s.call(o,r)&&l(t,r,o[r]);return t},r=(t,e,a)=>new Promise(((s,l)=>{var o=t=>{try{n(a.next(t))}catch(e){l(e)}},r=t=>{try{n(a.throw(t))}catch(e){l(e)}},n=t=>t.done?s(t.value):Promise.resolve(t.value).then(o,r);n((a=a.apply(t,e)).next())}));import{r as n,_ as c,c as d,o as i,a as u,w as m,b as f,n as p,t as _,v as b,d as g,e as h,f as v,F as y,g as x,h as k,i as D,u as w,j as S,k as N,l as C,S as P,D as I,m as $,T as E}from"./index-BnlLCfK6.js";function z(t=""){const e=n(t),a=n(t),s=t=>t instanceof Date&&!isNaN(t)?t.toISOString().split("T")[0]:"",l=t=>t instanceof Date&&!isNaN(t);return{displayValue:a,handleInput:t=>{console.log("handleInput event:",t);const s=t.target.value;return e.value=s,a.value=s,s},handleBlur:()=>{if(console.log("handleBlur current value:",e.value),!e.value)return{isValid:!0,value:""};const t=e.value.trim();if(/^[a-zA-Z]+$/.test(t)){const e=new Date;switch(t.toLowerCase()){case"t":case"today":return a.value=s(e),{isValid:!0,value:a.value};case"y":case"yday":return e.setDate(e.getDate()-1),a.value=s(e),{isValid:!0,value:a.value};case"tm":case"tmr":return e.setDate(e.getDate()+1),a.value=s(e),{isValid:!0,value:a.value}}}if(/^[+-]\d+$/.test(t)){const e=parseInt(t),l=new Date;return l.setDate(l.getDate()+e),a.value=s(l),{isValid:!0,value:a.value}}if(/^\d{3,4}$/.test(t)){const e=(new Date).getFullYear();let o,r;if(3===t.length?(o=parseInt(t[0]),r=parseInt(t.slice(1))):(o=parseInt(t.slice(0,2)),r=parseInt(t.slice(2))),o>=1&&o<=12&&r>=1&&r<=31){const t=new Date(e,o-1,r);if(l(t))return a.value=s(t),{isValid:!0,value:a.value}}}const o=["-",".","/"];for(const e of o)if(t.includes(e)){const[o,r]=t.split(e).map(Number),n=(new Date).getFullYear();if(o>=1&&o<=12&&r>=1&&r<=31){const t=new Date(n,o-1,r);if(l(t))return a.value=s(t),{isValid:!0,value:a.value}}}const r=new Date(t);return l(r)?(a.value=s(r),{isValid:!0,value:a.value}):{isValid:!1,value:e.value}},setToday:()=>{const t=(new Date).toISOString().split("T")[0];return e.value=t,a.value=t,t}}}const V={class:"card"},q={class:"card-header d-flex justify-content-between align-items-center"},L={class:"btn-group"},F=["disabled"],M={class:"card-body border-bottom"},T={class:"col-auto"},O=["value"],j={class:"col-auto"},H=["value"],Y={class:"col-auto"},R={class:"col-auto"},G=["value"],B={class:"col-auto",style:{"min-width":"200px","max-width":"300px"}},A={class:"col-auto d-flex align-items-end",style:{"min-width":"80px"}},K=["disabled"],U={class:"card-body p-0"},Z={class:"table-responsive"},J={class:"table table-hover table-sm mb-0"},W={class:"market-row"},Q=["onClick"],X={class:"text-end"},tt={class:"text-end"},et={class:"text-end text-danger"},at={class:"text-end text-success"},st={class:"text-end"},lt={key:0,class:"holding-stats-row"},ot={class:"text-end"},rt={class:"text-end text-danger"},nt={class:"text-end text-success"},ct={class:"text-end"},dt={key:1,class:"closed-stats-row"},it={class:"text-end"},ut={class:"text-end text-danger"},mt={class:"text-end text-success"},ft={class:"text-end"},pt={class:"holding-group-row"},_t=["onClick"],bt={class:"stock-row"},gt=["onClick"],ht={class:"company-name",style:{display:"inline-block",width:"80px","white-space":"normal","font-size":"10px",color:"#6c757d","margin-left":"4px"}},vt={class:"text-end"},yt={class:"text-end"},xt={class:"text-end text-danger"},kt={class:"text-end"},Dt={class:"text-end text-success"},wt={class:"text-end"},St={class:"text-end"},Nt={key:0},Ct={colspan:"11",class:"p-0"},Pt={class:"transaction-details"},It={class:"table table-sm mb-0"},$t={class:"transaction-info"},Et={class:"transaction-code"},zt={class:"text-center cost"},Vt={class:"quantity-price"},qt={class:"text-end cost"},Lt={class:"text-end amount"},Ft={class:"text-end cost"},Mt={class:"text-end amount"},Tt={class:"text-end fees"},Ot={class:"text-end"},jt={key:1},Ht={class:"closed-group-row"},Yt=["onClick"],Rt={class:"stock-row"},Gt=["onClick"],Bt={class:"company-name",style:{display:"inline-block",width:"80px","white-space":"normal","font-size":"10px",color:"#6c757d","margin-left":"4px"}},At={class:"text-end"},Kt={class:"text-end"},Ut={class:"text-end text-danger"},Zt={class:"text-end text-success"},Jt={class:"text-end"},Wt={class:"text-end"},Qt={key:0},Xt={colspan:"11",class:"p-0"},te={class:"transaction-details"},ee={class:"table table-sm mb-0"},ae={class:"transaction-info"},se={class:"transaction-code"},le={class:"text-center cost"},oe={class:"quantity-price"},re={class:"text-end cost"},ne={class:"text-end amount"},ce={class:"text-end cost"},de={class:"text-end amount"},ie={class:"text-end fees"},ue={class:"text-end"},me={key:1};const fe=c({__name:"ProfitStats",setup(t,{expose:e}){e();const a=w(),s=n(!1),l=n(!1),c=n(!0),d=n(new Set),i=n(new Set),u=n(new Set),m=n(new Set),f=n({}),p=n({}),_=n({}),b=n([]),g=n([]),h=S({startDate:"",endDate:"",market:"",stockCodes:[],holderId:""}),v=n(null),y=n(null),x=n(null),k=n(null),D=()=>({calculateMarketStats:(t,e=[])=>{const a={};return Object.entries(t).forEach((([t,s])=>{const[l]=t.split("-"),o=t.split("-")[1];e.length>0&&!e.includes(o)||(a[l]||(a[l]={total_stocks:0,transaction_count:0,total_buy:0,total_sell:0,total_fees:0,realized_profit:0,market_value:0,holding_profit:0,total_profit:0,profit_rate:0,holding_stats:{count:0,total_buy:0,total_sell:0,total_fees:0,realized_profit:0,market_value:0,holding_profit:0,total_profit:0,profit_rate:0},closed_stats:{count:0,total_buy:0,total_sell:0,total_fees:0,realized_profit:0,profit_rate:0}}),a[l].transaction_count+=s.transaction_count||0,a[l].total_buy+=s.total_buy||0,a[l].total_sell+=s.total_sell||0,a[l].total_fees+=s.total_fees||0,a[l].realized_profit+=s.realized_profit||0,a[l].market_value+=s.market_value||0,a[l].holding_profit+=s.holding_profit||0,s.current_quantity>0?(a[l].total_stocks+=1,a[l].holding_stats.count++,a[l].holding_stats.total_buy+=s.total_buy||0,a[l].holding_stats.total_sell+=s.total_sell||0,a[l].holding_stats.total_fees+=s.total_fees||0,a[l].holding_stats.realized_profit+=s.realized_profit||0,a[l].holding_stats.market_value+=s.market_value||0,a[l].holding_stats.holding_profit+=s.holding_profit||0):(a[l].total_stocks+=1,a[l].closed_stats.count++,a[l].closed_stats.total_buy+=s.total_buy||0,a[l].closed_stats.total_sell+=s.total_sell||0,a[l].closed_stats.total_fees+=s.total_fees||0,a[l].closed_stats.realized_profit+=s.realized_profit||0))})),Object.values(a).forEach((t=>{t.holding_stats.total_profit=(t.holding_stats.realized_profit||0)+(t.holding_stats.holding_profit||0),t.holding_stats.profit_rate=t.holding_stats.total_buy>0?(t.holding_stats.total_profit||0)/t.holding_stats.total_buy*100:0,t.closed_stats.profit_rate=t.closed_stats.total_buy>0?(t.closed_stats.realized_profit||0)/t.closed_stats.total_buy*100:0,t.total_profit=(t.realized_profit||0)+(t.holding_profit||0),t.profit_rate=t.total_buy>0?t.total_profit/t.total_buy*100:0})),a},getHoldingStocks:(t,e,a=[])=>Object.entries(t).filter((([t,s])=>{const[l]=t.split("-"),o=t.split("-")[1];return a.length>0?l===e&&s.current_quantity>0&&a.includes(o):l===e&&s.current_quantity>0})).map((([t,e])=>o({code:t.split("-")[1]},e))).sort(((t,e)=>{const a=new Date(t.last_transaction_date||0);return new Date(e.last_transaction_date||0)-a})),getClosedStocks:(t,e,a=[])=>Object.entries(t).filter((([t,s])=>{const[l]=t.split("-"),o=t.split("-")[1];return a.length>0?l===e&&s.current_quantity<=0&&a.includes(o):l===e&&s.current_quantity<=0})).map((([t,e])=>o({code:t.split("-")[1]},e))).sort(((t,e)=>{const a=new Date(t.last_transaction_date||0);return new Date(e.last_transaction_date||0)-a}))}),V=D(),q=N((()=>V.calculateMarketStats(p.value,h.stockCodes||[]))),L=N((()=>Object.keys(q.value).sort())),F=t=>{if(!t)return"-";const e=new Date(t);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`},M=t=>{const e=new E(Object.assign(document.createElement("div"),{className:"toast position-fixed top-0 end-0 m-3",innerHTML:`\n        <div class="toast-header">\n          <strong class="me-auto">提示</strong>\n          <button type="button" class="btn-close" data-bs-dismiss="toast"></button>\n        </div>\n        <div class="toast-body">${t}</div>\n      `}));document.body.appendChild(e._element),e.show(),setTimeout((()=>{e._element.remove()}),3e3)},T=()=>r(this,null,(function*(){var t;s.value=!0;try{const e={};h.startDate&&(e.start_date=h.startDate),h.endDate&&(e.end_date=h.endDate),h.market&&(e.market=h.market),(null==(t=h.stockCodes)?void 0:t.length)>0&&(e.stock_codes=h.stockCodes),h.holderId&&(e.holder_id=h.holderId);const a=yield $.get("/api/profit/",{params:e});a.data.success&&(p.value=a.data.data.stock_stats||{},_.value=a.data.data.transaction_details||{},d.value.clear(),i.value.clear(),u.value.clear(),m.value.clear(),Object.keys(q.value).forEach((t=>{d.value.add(t),i.value.add(t)})))}catch(e){console.error("查询失败:",e),M("查询失败，请稍后重试")}finally{s.value=!1}})),{handleBlur:O}=z(),j=n(""),H=n(""),Y=t=>t instanceof Date&&!isNaN(t),R=t=>{if("sell"!==t.transaction_type.toLowerCase())return 0;const e=Number(t.total_amount),a=Number(t.total_quantity)*Number(t.prev_avg_cost),s=Number(t.total_fees);return Number((e-a-s).toFixed(2))},G=()=>r(this,null,(function*(){try{const t=yield $.get("/api/stock/stocks");t.data.success&&(b.value=t.data.data.items)}catch(t){console.error("获取股票列表失败:",t)}})),B=()=>r(this,null,(function*(){try{console.log("开始加载持有人列表...");const t=yield $.get("/api/transaction/get_accessible_holders");console.log("持有人列表API响应:",t.data),t.data.success?(g.value=t.data.data||[],console.log(`成功加载 ${g.value.length} 个持有人:`,g.value),g.value.length>0&&console.log("持有人数据示例:",g.value[0])):(console.error("加载持有人列表失败:",t.data.message),M("加载持有人列表失败: "+t.data.message))}catch(t){console.error("加载持有人列表失败:",t),M("加载持有人列表失败，请稍后重试"),g.value=[]}}));C((()=>{console.log("ProfitStats组件已挂载，开始初始化..."),G(),B(),T()}));const A={router:a,loading:s,refreshLoading:l,searchVisible:c,expandedMarkets:d,expandedHoldingGroups:i,expandedClosedGroups:u,expandedStocks:m,rawMarketStats:f,stockStats:p,transactionDetails:_,allStocks:b,holders:g,searchForm:h,startDate:v,endDate:y,market:x,holder:k,focusNext:(t,e)=>{var a,s,l;switch(t.preventDefault(),e){case"endDate":null==(a=y.value)||a.focus();break;case"market":null==(s=x.value)||s.focus();break;case"search":T();break;case"holder":null==(l=k.value)||l.focus()}},useStatsCalculator:D,statsCalculator:V,marketStats:q,getHoldingStocks:t=>V.getHoldingStocks(p.value,t,h.stockCodes||[]),getClosedStocks:t=>V.getClosedStocks(p.value,t,h.stockCodes||[]),getMarkets:L,formatNumber:(t,e=2)=>null==t?"-":Number(t).toLocaleString("zh-HK",{minimumFractionDigits:e,maximumFractionDigits:e}),formatRate:t=>null==t?"-":t.toFixed(2)+"%",formatDate:F,getProfitClass:t=>t?t>0?"text-success":t<0?"text-danger":"":"",isMarketExpanded:t=>d.value.has(t),isHoldingGroupExpanded:t=>i.value.has(t),isClosedGroupExpanded:t=>u.value.has(t),isStockExpanded:(t,e)=>{const a=`${t}-${e}`;return m.value.has(a)},toggleMarket:t=>{if(d.value.has(t)){d.value.delete(t),i.value.delete(t),u.value.delete(t);Object.keys(p.value).filter((e=>e.startsWith(t))).forEach((t=>{m.value.delete(t)}))}else d.value.add(t),i.value.add(t)},toggleHoldingGroup:t=>{i.value.has(t)?i.value.delete(t):i.value.add(t)},toggleClosedGroup:t=>{u.value.has(t)?u.value.delete(t):u.value.add(t)},toggleStock:(t,e)=>{const a=`${t}-${e}`;m.value.has(a)?m.value.delete(a):m.value.add(a)},expandAll:()=>{Object.keys(q.value).forEach((t=>{d.value.add(t),i.value.add(t)}))},collapseAll:()=>{d.value.clear(),i.value.clear(),u.value.clear()},toggleSearch:()=>{c.value=!c.value},showToast:M,search:T,resetSearch:()=>{h.startDate="",h.endDate="",h.market="",h.stockCodes=[],h.holderId="",T()},refreshMarketValue:()=>r(this,null,(function*(){var t,e;if(!l.value){l.value=!0;try{console.log("开始刷新市值..."),M("正在刷新市值，请稍等...");const t=yield $.post("/api/profit/refresh_prices");if(console.log("收到后端响应:",t.data),t.data.success){const{items:e,success_count:a,failed_count:s}=t.data.data;if(e&&e.length>0){console.log(`共刷新了 ${e.length} 只股票的价格`),e.forEach((t=>{const e=`${t.market}-${t.code}`;p.value[e]?(console.log(`更新股票 ${e} 数据:`,t),p.value[e].current_price=t.current_price,p.value[e].market_value=t.market_value,p.value[e].holding_profit=t.holding_profit,p.value[e].total_profit=t.total_profit,p.value[e].profit_rate=t.profit_rate):console.warn(`未找到股票 ${e} 的数据`)})),console.log("重新计算市场统计数据");const t=JSON.parse(JSON.stringify(p.value));p.value=t,M(`市值刷新完成：${a} 个成功，${s} 个失败`)}else M(t.data.data.message||"没有持仓股票需要刷新")}else console.error("刷新市值失败:",t.data.message),M(`刷新市值失败: ${t.data.message||"未知错误"}`)}catch(a){console.error("刷新市值请求失败:",a);const s=(null==(e=null==(t=a.response)?void 0:t.data)?void 0:e.message)||a.message||"请求失败";M(`刷新市值失败：${s}`)}finally{l.value=!1}}})),addTransaction:()=>{a.push("/transactions/add")},dateInputBlur:O,startDateDisplayValue:j,endDateDisplayValue:H,handleStartDateInput:t=>{const e=t.target.value;j.value=e,h.startDate=e},handleStartDateBlur:()=>{if(!j.value)return void(h.startDate="");const t=j.value.trim();let e=null;if(/^[a-zA-Z]+$/.test(t)){const a=new Date;switch(t.toLowerCase()){case"t":case"today":e=F(a);break;case"y":case"yday":a.setDate(a.getDate()-1),e=F(a);break;case"tm":case"tmr":a.setDate(a.getDate()+1),e=F(a)}}if(/^[+-]\d+$/.test(t)){const a=parseInt(t),s=new Date;s.setDate(s.getDate()+a),e=F(s)}if(/^\d{3,4}$/.test(t)){const a=(new Date).getFullYear();let s,l;if(3===t.length?(s=parseInt(t[0]),l=parseInt(t.slice(1))):(s=parseInt(t.slice(0,2)),l=parseInt(t.slice(2))),s>=1&&s<=12&&l>=1&&l<=31){const t=new Date(a,s-1,l);Y(t)&&(e=F(t))}}const a=["-",".","/"];for(const s of a)if(t.includes(s)){const[a,l]=t.split(s).map(Number),o=(new Date).getFullYear();if(a>=1&&a<=12&&l>=1&&l<=31){const t=new Date(o,a-1,l);if(Y(t)){e=F(t);break}}}if(!e){const a=new Date(t);Y(a)&&(e=F(a))}e&&(j.value=e,h.startDate=e,h.endDate&&e>h.endDate&&(h.endDate=e,H.value=e))},handleEndDateInput:t=>{const e=t.target.value;H.value=e,h.endDate=e},handleEndDateBlur:()=>{if(!H.value)return void(h.endDate="");const t=H.value.trim();let e=null;if(/^[a-zA-Z]+$/.test(t)){const a=new Date;switch(t.toLowerCase()){case"t":case"today":e=F(a);break;case"y":case"yday":a.setDate(a.getDate()-1),e=F(a);break;case"tm":case"tmr":a.setDate(a.getDate()+1),e=F(a)}}if(/^[+-]\d+$/.test(t)){const a=parseInt(t),s=new Date;s.setDate(s.getDate()+a),e=F(s)}if(/^\d{3,4}$/.test(t)){const a=(new Date).getFullYear();let s,l;if(3===t.length?(s=parseInt(t[0]),l=parseInt(t.slice(1))):(s=parseInt(t.slice(0,2)),l=parseInt(t.slice(2))),s>=1&&s<=12&&l>=1&&l<=31){const t=new Date(a,s-1,l);Y(t)&&(e=F(t))}}const a=["-",".","/"];for(const s of a)if(t.includes(s)){const[a,l]=t.split(s).map(Number),o=(new Date).getFullYear();if(a>=1&&a<=12&&l>=1&&l<=31){const t=new Date(o,a-1,l);if(Y(t)){e=F(t);break}}}if(!e){const a=new Date(t);Y(a)&&(e=F(a))}e&&(H.value=e,h.endDate=e,h.startDate&&e<h.startDate&&(h.startDate=e,j.value=e))},isValidDate:Y,processTransactionDetails:t=>t?[...t].sort(((t,e)=>{const a=new Date(t.transaction_date),s=new Date(e.transaction_date);if(a.getTime()!==s.getTime())return s.getTime()-a.getTime();const l=new Date(t.created_at||0);return new Date(e.created_at||0).getTime()-l.getTime()})):[],calculateHKDAmount:t=>t.total_amount*t.exchange_rate,calculateProfit:R,calculateProfitRate:t=>{if("sell"!==t.transaction_type.toLowerCase())return 0;const e=R(t),a=Number(t.total_quantity)*Number(t.prev_avg_cost);return a>0?Number((e/a*100).toFixed(2)):0},fetchStocks:G,sortTransactionDetails:t=>t?[...t].sort(((t,e)=>{const a=new Date(t.transaction_date).getTime(),s=new Date(e.transaction_date).getTime();return a!==s?s-a:e.id-t.id})):[],loadHolders:B,ref:n,reactive:S,onMounted:C,computed:N,get useRouter(){return w},DateInput:I,get axios(){return $},get useDateInput(){return z},StockSelector:P,get Toast(){return E}};return Object.defineProperty(A,"__isScriptSetup",{enumerable:!1,value:!0}),A}},[["render",function(t,e,a,s,l,o){return i(),d("div",V,[u("div",q,[e[14]||(e[14]=u("h4",{class:"mb-0"},"盈利统计",-1)),u("div",L,[u("button",{type:"button",class:"btn btn-sm btn-outline-secondary",onClick:s.toggleSearch},[u("i",{class:p(["bi",s.searchVisible?"bi-chevron-up":"bi-search"])},null,2),f(" "+_(s.searchVisible?"收起":"搜索"),1)]),u("button",{type:"button",class:"btn btn-sm btn-outline-primary",onClick:s.refreshMarketValue,disabled:s.refreshLoading},[u("i",{class:p(["bi",s.refreshLoading?"bi-arrow-clockwise bi-spin":"bi-arrow-clockwise"])},null,2),e[12]||(e[12]=f(" 刷新市值 "))],8,F),u("button",{type:"button",class:"btn btn-sm btn-primary",onClick:s.addTransaction},e[13]||(e[13]=[u("i",{class:"bi bi-plus-lg"},null,-1),f(" 添加记录 ")]))])]),m(u("div",M,[u("form",{onSubmit:g(s.search,["prevent"]),class:"row g-2 align-items-end"},[u("div",T,[e[15]||(e[15]=u("label",{class:"form-label small"},"开始日期",-1)),u("input",{type:"text",class:"form-control form-control-sm",style:{width:"130px"},value:s.startDateDisplayValue,onInput:s.handleStartDateInput,onBlur:s.handleStartDateBlur,onKeydown:[e[0]||(e[0]=h(g((t=>s.focusNext(t,"endDate")),["prevent"]),["enter"])),e[1]||(e[1]=h((t=>s.focusNext(t,"endDate")),["tab"]))],placeholder:"YYYY-MM-DD",ref:"startDate"},null,40,O)]),u("div",j,[e[16]||(e[16]=u("label",{class:"form-label small"},"结束日期",-1)),u("input",{type:"text",class:"form-control form-control-sm",style:{width:"130px"},value:s.endDateDisplayValue,onInput:s.handleEndDateInput,onBlur:s.handleEndDateBlur,onKeydown:[e[2]||(e[2]=h(g((t=>s.focusNext(t,"market")),["prevent"]),["enter"])),e[3]||(e[3]=h((t=>s.focusNext(t,"market")),["tab"]))],placeholder:"YYYY-MM-DD",ref:"endDate"},null,40,H)]),u("div",Y,[e[18]||(e[18]=u("label",{class:"form-label small"},"市场",-1)),m(u("select",{class:"form-select form-select-sm",style:{width:"100px"},"onUpdate:modelValue":e[4]||(e[4]=t=>s.searchForm.market=t),ref:"market",onKeydown:[e[5]||(e[5]=h(g((t=>s.focusNext(t,"holder")),["prevent"]),["enter"])),e[6]||(e[6]=h((t=>s.focusNext(t,"holder")),["tab"]))]},e[17]||(e[17]=[u("option",{value:""},"全部",-1),u("option",{value:"HK"},"HK",-1),u("option",{value:"USA"},"USA",-1)]),544),[[v,s.searchForm.market]])]),u("div",R,[e[20]||(e[20]=u("label",{class:"form-label small"},"持有人",-1)),m(u("select",{class:"form-select form-select-sm",style:{width:"150px"},"onUpdate:modelValue":e[7]||(e[7]=t=>s.searchForm.holderId=t),ref:"holder",onKeydown:[e[8]||(e[8]=h(g((t=>s.focusNext(t,"stockCodes")),["prevent"]),["enter"])),e[9]||(e[9]=h((t=>s.focusNext(t,"stockCodes")),["tab"]))]},[e[19]||(e[19]=u("option",{value:""},"全部持有人",-1)),(i(!0),d(y,null,x(s.holders,(t=>(i(),d("option",{key:t.id,value:t.id},_(t.name),9,G)))),128))],544),[[v,s.searchForm.holderId]])]),u("div",B,[e[21]||(e[21]=u("label",{class:"form-label small"},"股票代码",-1)),k(s.StockSelector,{modelValue:s.searchForm.stockCodes,"onUpdate:modelValue":e[10]||(e[10]=t=>s.searchForm.stockCodes=t),stocks:s.allStocks,market:s.searchForm.market,class:"stock-selector-sm",ref:"stockCodes",onKeydown:e[11]||(e[11]=h(g((t=>s.focusNext(t,"search")),["prevent"]),["enter"]))},null,8,["modelValue","stocks","market"])]),e[24]||(e[24]=u("div",{class:"col-auto flex-grow-1",style:{"max-width":"50px"}},null,-1)),u("div",A,[u("button",{type:"submit",class:"btn btn-sm btn-primary w-100 border border-primary text-white",style:{"background-color":"#0D6EFD"},disabled:s.loading,ref:"searchBtn"},e[22]||(e[22]=[u("i",{class:"bi bi-search me-1"},null,-1),f("查询 ")]),8,K)]),u("div",{class:"col-auto d-flex align-items-end",style:{"min-width":"80px"}},[u("button",{type:"button",class:"btn btn-sm btn-outline-secondary w-100",onClick:s.resetSearch},e[23]||(e[23]=[u("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),f("重置 ")]))])],32)],512),[[b,s.searchVisible]]),u("div",U,[u("div",Z,[u("table",J,[e[46]||(e[46]=u("thead",{class:"table-light"},[u("tr",null,[u("th"),u("th",null,"市场"),u("th",{class:"text-end"},"股票数量"),u("th",{class:"text-end"},"笔数"),u("th",{class:"text-end"},"买入总额"),u("th",{class:"text-end",title:"移动加权平均价"},"平均价格"),u("th",{class:"text-end"},"卖出总额"),u("th",{class:"text-end"},"费用"),u("th",{class:"text-end"},"已实现盈亏"),u("th",{class:"text-end"},"现价"),u("th",{class:"text-end"},"持仓盈亏"),u("th",{class:"text-end"},"总盈亏"),u("th",{class:"text-end"},"盈亏率")])],-1)),u("tbody",null,[(i(!0),d(y,null,x(s.getMarkets,(t=>(i(),d(y,{key:t},[u("tr",W,[u("td",null,[u("button",{onClick:e=>s.toggleMarket(t),class:"btn btn-sm btn-outline-primary"},[u("i",{class:p(["bi bi-chevron-right",{"rotate-90":s.isMarketExpanded(t)}])},null,2)],8,Q)]),u("td",null,_(t),1),u("td",X,_(s.formatNumber(s.marketStats[t].total_stocks,0)),1),u("td",tt,_(s.marketStats[t].transaction_count),1),u("td",et,_(s.formatNumber(s.marketStats[t].total_buy)),1),e[25]||(e[25]=u("td",{class:"text-end"},"-",-1)),u("td",at,_(s.formatNumber(s.marketStats[t].total_sell)),1),u("td",st,_(s.formatNumber(s.marketStats[t].total_fees)),1),u("td",{class:p(["text-end",s.getProfitClass(s.marketStats[t].realized_profit)])},_(s.formatNumber(s.marketStats[t].realized_profit)),3),e[26]||(e[26]=u("td",{class:"text-end"},"-",-1)),u("td",{class:p(["text-end",s.getProfitClass(s.marketStats[t].holding_profit)])},_(s.formatNumber(s.marketStats[t].holding_profit)),3),u("td",{class:p(["text-end",s.getProfitClass(s.marketStats[t].total_profit)])},_(s.formatNumber(s.marketStats[t].total_profit)),3),u("td",{class:p(["text-end",s.getProfitClass(s.marketStats[t].profit_rate)])},_(s.formatRate(s.marketStats[t].profit_rate)),3)]),s.isMarketExpanded(t)?(i(),d("tr",lt,[e[27]||(e[27]=u("td",null,null,-1)),e[28]||(e[28]=u("td",null,[u("strong",null,"持仓统计")],-1)),u("td",ot,_(s.marketStats[t].holding_stats.count),1),e[29]||(e[29]=u("td",{class:"text-end"},"-",-1)),u("td",rt,_(s.formatNumber(s.marketStats[t].holding_stats.total_buy)),1),e[30]||(e[30]=u("td",{class:"text-end"},"-",-1)),u("td",nt,_(s.formatNumber(s.marketStats[t].holding_stats.total_sell)),1),u("td",ct,_(s.formatNumber(s.marketStats[t].holding_stats.total_fees)),1),u("td",{class:p(["text-end",s.getProfitClass(s.marketStats[t].holding_stats.realized_profit)])},_(s.formatNumber(s.marketStats[t].holding_stats.realized_profit)),3),e[31]||(e[31]=u("td",{class:"text-end"},"-",-1)),u("td",{class:p(["text-end",s.getProfitClass(s.marketStats[t].holding_stats.holding_profit)])},_(s.formatNumber(s.marketStats[t].holding_stats.holding_profit)),3),u("td",{class:p(["text-end",s.getProfitClass(s.marketStats[t].holding_stats.total_profit)])},_(s.formatNumber(s.marketStats[t].holding_stats.total_profit)),3),u("td",{class:p(["text-end",s.getProfitClass(s.marketStats[t].holding_stats.profit_rate)])},_(s.formatRate(s.marketStats[t].holding_stats.profit_rate)),3)])):D("",!0),s.isMarketExpanded(t)?(i(),d("tr",dt,[e[32]||(e[32]=u("td",null,null,-1)),e[33]||(e[33]=u("td",null,[u("strong",null,"已清仓统计")],-1)),u("td",it,_(s.marketStats[t].closed_stats.count),1),e[34]||(e[34]=u("td",{class:"text-end"},"-",-1)),u("td",ut,_(s.formatNumber(s.marketStats[t].closed_stats.total_buy)),1),e[35]||(e[35]=u("td",{class:"text-end"},"-",-1)),u("td",mt,_(s.formatNumber(s.marketStats[t].closed_stats.total_sell)),1),u("td",ft,_(s.formatNumber(s.marketStats[t].closed_stats.total_fees)),1),u("td",{class:p(["text-end",s.getProfitClass(s.marketStats[t].closed_stats.realized_profit)])},_(s.formatNumber(s.marketStats[t].closed_stats.realized_profit)),3),e[36]||(e[36]=u("td",{class:"text-end"},"-",-1)),e[37]||(e[37]=u("td",{class:"text-end"},"-",-1)),e[38]||(e[38]=u("td",{class:"text-end"},"-",-1)),u("td",{class:p(["text-end",s.getProfitClass(s.marketStats[t].closed_stats.profit_rate)])},_(s.formatRate(s.marketStats[t].closed_stats.profit_rate)),3)])):D("",!0),s.isMarketExpanded(t)?(i(),d(y,{key:2},[u("tr",pt,[u("td",null,[u("button",{onClick:e=>s.toggleHoldingGroup(t),class:"btn btn-sm btn-outline-secondary"},[u("i",{class:p(["bi bi-chevron-right",{"rotate-90":s.isHoldingGroupExpanded(t)}])},null,2)],8,_t)]),e[39]||(e[39]=u("td",{colspan:"12"},[u("strong",null,"持仓股票")],-1))]),s.isHoldingGroupExpanded(t)?(i(!0),d(y,{key:0},x(s.getHoldingStocks(t),(a=>(i(),d(y,{key:a.code},[u("tr",bt,[u("td",null,[u("button",{onClick:e=>s.toggleStock(t,a.code),class:"btn btn-sm btn-outline-secondary"},[u("i",{class:p(["bi bi-chevron-right",{"rotate-90":s.isStockExpanded(t,a.code)}])},null,2)],8,gt)]),u("td",null,[f(_(a.code)+" ",1),u("span",ht,_(a.stock_name),1)]),u("td",vt,_(s.formatNumber(a.current_quantity,0)),1),u("td",yt,_(a.transaction_count),1),u("td",xt,_(s.formatNumber(a.total_buy)),1),u("td",kt,_(s.formatNumber(a.average_cost,3)),1),u("td",Dt,_(s.formatNumber(a.total_sell)),1),u("td",wt,_(s.formatNumber(a.total_fees)),1),u("td",{class:p(["text-end",s.getProfitClass(a.realized_profit)])},_(s.formatNumber(a.realized_profit)),3),u("td",St,_(a.current_quantity>0?s.formatNumber(a.current_price,3):"-"),1),u("td",{class:p(["text-end",s.getProfitClass(a.holding_profit)])},_(a.current_quantity>0?s.formatNumber(a.holding_profit):"-"),3),u("td",{class:p(["text-end",s.getProfitClass(a.total_profit)])},_(s.formatNumber(a.total_profit)),3),u("td",{class:p(["text-end",s.getProfitClass(a.profit_rate)])},_(s.formatRate(a.profit_rate)),3)]),s.isStockExpanded(t,a.code)?(i(),d("tr",Nt,[u("td",Ct,[u("div",Pt,[u("table",It,[e[41]||(e[41]=u("thead",{class:"table-light"},[u("tr",null,[u("th",{class:"transaction-info"},"交易日期"),u("th",{class:"text-center cost"},"交易前数量"),u("th",{class:"quantity-price"},"数量@单价"),u("th",{class:"text-end cost"},"交易后数量"),u("th",{class:"text-end amount"},"买入金额"),u("th",{class:"text-end cost",title:"移动加权平均价"},"平均价格"),u("th",{class:"text-end amount"},"卖出金额"),u("th",{class:"text-end fees"},"费用"),u("th",{class:"text-end profit"},"盈亏"),u("th",{class:"text-end current-price"},"盈亏率"),u("th",{class:"text-end holding-value"},"持有人")])],-1)),u("tbody",null,[s.transactionDetails[`${t}-${a.code}`]?(i(!0),d(y,{key:0},x(s.sortTransactionDetails(s.transactionDetails[`${t}-${a.code}`]),(t=>(i(),d("tr",{key:t.id},[u("td",$t,[f(_(s.formatDate(t.transaction_date))+" ",1),u("span",{class:p(["transaction-type-badge","buy"===t.transaction_type.toLowerCase()?"buy":"sell"])},_("buy"===t.transaction_type.toLowerCase()?"买入":"卖出"),3),u("span",Et,_(t.transaction_code?t.transaction_code.trim():"-"),1)]),u("td",zt,_(s.formatNumber(t.prev_quantity,0)),1),u("td",Vt,_(s.formatNumber(t.total_quantity,0))+" @ "+_(s.formatNumber(t.total_amount/t.total_quantity,3)),1),u("td",qt,_(s.formatNumber(t.current_quantity,0)),1),u("td",Lt,_("buy"===t.transaction_type.toLowerCase()?s.formatNumber(t.total_amount):""),1),u("td",Ft,["buy"===t.transaction_type.toLowerCase()?(i(),d(y,{key:0},[f(_(s.formatNumber(t.current_avg_cost,3)),1)],64)):(i(),d(y,{key:1},[f(_(s.formatNumber(t.prev_avg_cost,3)),1)],64))]),u("td",Mt,_("sell"===t.transaction_type.toLowerCase()?s.formatNumber(t.total_amount):""),1),u("td",Tt,_(s.formatNumber(t.total_fees)),1),u("td",{class:p(["text-end",s.getProfitClass(s.calculateProfit(t))])},_("sell"===t.transaction_type.toLowerCase()?s.formatNumber(s.calculateProfit(t)):"-"),3),u("td",{class:p(["text-end",s.getProfitClass(s.calculateProfitRate(t))])},_("sell"===t.transaction_type.toLowerCase()?s.formatRate(s.calculateProfitRate(t)):"-"),3),u("td",Ot,_(t.holder_name||"-"),1)])))),128)):(i(),d("tr",jt,e[40]||(e[40]=[u("td",{colspan:"11",class:"text-center py-2"},[u("small",{class:"text-muted"},"暂无交易明细数据")],-1)])))])])])])])):D("",!0)],64)))),128)):D("",!0),u("tr",Ht,[u("td",null,[u("button",{onClick:e=>s.toggleClosedGroup(t),class:"btn btn-sm btn-outline-secondary"},[u("i",{class:p(["bi bi-chevron-right",{"rotate-90":s.isClosedGroupExpanded(t)}])},null,2)],8,Yt)]),e[42]||(e[42]=u("td",{colspan:"12"},[u("strong",null,"已清仓股票")],-1))]),s.isClosedGroupExpanded(t)?(i(!0),d(y,{key:1},x(s.getClosedStocks(t),(a=>(i(),d(y,{key:a.code},[u("tr",Rt,[u("td",null,[u("button",{onClick:e=>s.toggleStock(t,a.code),class:"btn btn-sm btn-outline-secondary"},[u("i",{class:p(["bi bi-chevron-right",{"rotate-90":s.isStockExpanded(t,a.code)}])},null,2)],8,Gt)]),u("td",null,[f(_(a.code)+" ",1),u("span",Bt,_(a.stock_name),1)]),u("td",At,_(a.quantity||"-"),1),u("td",Kt,_(a.transaction_count),1),u("td",Ut,_(s.formatNumber(a.total_buy)),1),e[43]||(e[43]=u("td",{class:"text-end"},"-",-1)),u("td",Zt,_(s.formatNumber(a.total_sell)),1),u("td",Jt,_(s.formatNumber(a.total_fees)),1),u("td",{class:p(["text-end",s.getProfitClass(a.realized_profit)])},_(s.formatNumber(a.realized_profit)),3),u("td",Wt,_(a.current_quantity>0?s.formatNumber(a.current_price,3):"-"),1),u("td",{class:p(["text-end",s.getProfitClass(a.holding_profit)])},_(a.current_quantity>0?s.formatNumber(a.holding_profit):"-"),3),u("td",{class:p(["text-end",s.getProfitClass(a.total_profit)])},_(s.formatNumber(a.total_profit)),3),u("td",{class:p(["text-end",s.getProfitClass(a.profit_rate)])},_(s.formatRate(a.profit_rate)),3)]),s.isStockExpanded(t,a.code)?(i(),d("tr",Qt,[u("td",Xt,[u("div",te,[u("table",ee,[e[45]||(e[45]=u("thead",{class:"table-light"},[u("tr",null,[u("th",{class:"transaction-info"},"交易日期"),u("th",{class:"text-center cost"},"交易前数量"),u("th",{class:"quantity-price"},"数量@单价"),u("th",{class:"text-end cost"},"交易后数量"),u("th",{class:"text-end amount"},"买入金额"),u("th",{class:"text-end cost",title:"移动加权平均价"},"平均价格"),u("th",{class:"text-end amount"},"卖出金额"),u("th",{class:"text-end fees"},"费用"),u("th",{class:"text-end profit"},"盈亏"),u("th",{class:"text-end current-price"},"盈亏率"),u("th",{class:"text-end holding-value"},"持有人")])],-1)),u("tbody",null,[s.transactionDetails[`${t}-${a.code}`]?(i(!0),d(y,{key:0},x(s.sortTransactionDetails(s.transactionDetails[`${t}-${a.code}`]),(t=>(i(),d("tr",{key:t.id},[u("td",ae,[f(_(s.formatDate(t.transaction_date))+" ",1),u("span",{class:p(["transaction-type-badge","buy"===t.transaction_type.toLowerCase()?"buy":"sell"])},_("buy"===t.transaction_type.toLowerCase()?"买入":"卖出"),3),u("span",se,_(t.transaction_code?t.transaction_code.trim():"-"),1)]),u("td",le,_(s.formatNumber(t.prev_quantity,0)),1),u("td",oe,_(s.formatNumber(t.total_quantity,0))+" @ "+_(s.formatNumber(t.total_amount/t.total_quantity,3)),1),u("td",re,_(s.formatNumber(t.current_quantity,0)),1),u("td",ne,_("buy"===t.transaction_type.toLowerCase()?s.formatNumber(t.total_amount):""),1),u("td",ce,["buy"===t.transaction_type.toLowerCase()?(i(),d(y,{key:0},[f(_(s.formatNumber(t.current_avg_cost,3)),1)],64)):(i(),d(y,{key:1},[f(_(s.formatNumber(t.prev_avg_cost,3)),1)],64))]),u("td",de,_("sell"===t.transaction_type.toLowerCase()?s.formatNumber(t.total_amount):""),1),u("td",ie,_(s.formatNumber(t.total_fees)),1),u("td",{class:p(["text-end",s.getProfitClass(s.calculateProfit(t))])},_("sell"===t.transaction_type.toLowerCase()?s.formatNumber(s.calculateProfit(t)):"-"),3),u("td",{class:p(["text-end",s.getProfitClass(s.calculateProfitRate(t))])},_("sell"===t.transaction_type.toLowerCase()?s.formatRate(s.calculateProfitRate(t)):"-"),3),u("td",ue,_(t.holder_name||"-"),1)])))),128)):(i(),d("tr",me,e[44]||(e[44]=[u("td",{colspan:"11",class:"text-center py-2"},[u("small",{class:"text-muted"},"暂无交易明细数据")],-1)])))])])])])])):D("",!0)],64)))),128)):D("",!0)],64)):D("",!0)],64)))),128))])])])])])}],["__scopeId","data-v-bf3b72d3"],["__file","ProfitStats.vue"]]);export{fe as default};
