var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,n=(t,a,o)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o,r=(e,t,a)=>new Promise(((o,s)=>{var l=e=>{try{r(a.next(e))}catch(t){s(t)}},n=e=>{try{r(a.throw(e))}catch(t){s(t)}},r=e=>e.done?o(e.value):Promise.resolve(e.value).then(l,n);r((a=a.apply(e,t)).next())}));import{_ as c,p as d,w as i,o as u,c as v,a as p,q as m,n as f,s as k,t as _,i as y,e as b,d as g,b as h,F as w,h as S,x as R,u as q,r as K,y as x,l as C,z as M,A as D,B,m as $,C as A,S as U,k as N,M as I}from"./index-CrdR-tsv.js";const F={class:"card"},V={class:"card-body"},E={class:"row mb-4"},L={class:"col-md-4"},H={class:"date-input"},T={class:"invalid-feedback","data-testid":"transaction-date-error"},P={class:"col-md-4"},O={class:"position-relative"},j={class:"stock-input-wrapper"},Y=["onKeydown"],W={key:0,class:"selected-stock","data-testid":"selected-stock-info"},Q={class:"invalid-feedback","data-testid":"stock-code-error"},z={key:0,class:"stock-list","data-testid":"stock-search-list"},G=["onClick","onMouseover","data-testid"],J={class:"col-md-4"},X={class:"invalid-feedback","data-testid":"transaction-code-error"},Z={class:"row mb-4"},ee={class:"col-md-4"},te={class:"invalid-feedback","data-testid":"transaction-type-error"},ae={class:"mb-4"},oe={class:"d-flex justify-content-between align-items-center mb-2"},se={class:"border rounded p-3","data-testid":"transaction-details-container"},le=["data-testid"],ne={class:"col-md-5"},re=["data-testid"],ce=["onUpdate:modelValue","onKeydown","data-testid"],de={class:"col-md-5"},ie=["data-testid"],ue=["onUpdate:modelValue","onKeydown","data-testid"],ve=["data-testid"],pe={class:"col-md-2 d-flex align-items-end"},me=["onClick","disabled","data-testid"],fe={class:"mb-4"},ke={class:"border rounded p-3","data-testid":"fees-container"},_e={class:"row g-3"},ye={class:"col-md-4"},be={class:"col-md-4"},ge={class:"col-md-4"},he={class:"col-md-4"},we={class:"col-md-4"},Se={class:"d-flex justify-content-end gap-2"},Re=["disabled"],qe={key:0,class:"spinner-border spinner-border-sm me-1"},Ke=["disabled"],xe={key:0,class:"spinner-border spinner-border-sm me-1"},Ce={class:"stock-modal"},Me={class:"stock-modal-body","data-testid":"add-stock-modal"},De={class:"mb-3"},Be=["onKeydown"],$e={class:"invalid-feedback","data-testid":"new-stock-code-error"},Ae={class:"mb-3"},Ue={class:"invalid-feedback","data-testid":"new-stock-market-error"},Ne={class:"mb-3"},Ie={class:"invalid-feedback","data-testid":"new-stock-name-error"},Fe={class:"mb-3"},Ve={class:"mb-3"},Ee=["value"],Le={class:"stock-modal-footer"},He=["disabled"],Te={key:0,class:"spinner-border spinner-border-sm me-1"};const Pe=c({__name:"TransactionAdd",setup(e,{expose:c}){c();const d=q(),i=A(),u=K(!1),v=K(!1),p=K({transaction_date:"",stock_code:"",stock_name:"",transaction_code:"",transaction_type:"",details:[{quantity:null,price:null}],broker_fee:"",transaction_levy:"",stamp_duty:"",trading_fee:"",deposit_fee:"",market:"HK"}),m=K(!1),f=K({}),k={transaction_date:K(null),stock_code:K(null),transaction_code:K(null),transaction_type:K(null),broker_fee:K(null),transaction_levy:K(null),stamp_duty:K(null),trading_fee:K(null),deposit_fee:K(null),cancelBtn:K(null),saveBtn:K(null),saveAndAddBtn:K(null),addDetailBtn:K(null),quantityRefs:[],priceRefs:[]},_=K(!1),y=K([]),b=K(-1),g=K(null),h=K(!1),w=K({market:"HK",code:"",name:"",full_name:"",current_price:null,alertMessage:""}),S=K(!1);let R=null;const F=()=>{p.value.details.push({quantity:null,price:null})},V=e=>{const t=new Date(e);return t instanceof Date&&!isNaN(t)},E=e=>{const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`},L=()=>{f.value={};let e=!0;return p.value.transaction_date&&V(p.value.transaction_date)||(f.value.transaction_date="请输入有效的交易日期",e=!1),p.value.stock_code||(f.value.stock_code="请选择股票",e=!1),p.value.transaction_code||(f.value.transaction_code="请输入交易编号",e=!1),p.value.transaction_type||(f.value.transaction_type="请选择交易类型",e=!1),p.value.details.forEach(((t,a)=>{const o=parseFloat(t.price);(isNaN(o)||o<=0)&&(f.value[`price_${a}`]="请输入有效的价格",e=!1);const s=parseFloat(t.quantity);(isNaN(s)||s<=0)&&(f.value[`quantity_${a}`]="请输入有效的数量",e=!1)})),e};x((()=>p.value.transaction_type),(()=>{"buy"===p.value.transaction_type&&(p.value.stamp_duty="")}));const H=e=>{e&&e.code&&(p.value.stock_code=e.code,p.value.stock_name=e.name||"",p.value.market=e.market||"HK",m.value=!0,delete f.value.stock_code),_.value=!1,y.value=[],b.value=-1},T=()=>r(this,null,(function*(){var e,t;try{if(!L()||u.value)return;u.value=!0;const e=p.value.details.reduce(((e,t)=>e+(parseFloat(t.quantity)||0)),0),t=p.value.details.reduce(((e,t)=>e+(parseFloat(t.quantity)||0)*(parseFloat(t.price)||0)),0),a={transaction_date:p.value.transaction_date,stock_code:p.value.stock_code,market:p.value.market,transaction_type:p.value.transaction_type.toLowerCase(),transaction_code:p.value.transaction_code,details:p.value.details.map((e=>({quantity:parseFloat(e.quantity)||0,price:parseFloat(e.price)||0}))),total_quantity:e,total_amount:t,broker_fee:parseFloat(p.value.broker_fee)||0,transaction_levy:parseFloat(p.value.transaction_levy)||0,stamp_duty:parseFloat(p.value.stamp_duty)||0,trading_fee:parseFloat(p.value.trading_fee)||0,deposit_fee:parseFloat(p.value.deposit_fee)||0};console.log("提交的交易数据:",a),console.log("表单原始数据:",p.value);const o=yield $.post("/api/stock/transactions",a);if(!o.data.success)throw new Error(o.data.message||"操作失败");v.value?(P(),v.value=!1,i.success("交易记录添加成功"),yield M(),k.transaction_date.value&&k.transaction_date.value.focus()):(i.success("交易记录添加成功"),d.push("/transactions"))}catch(a){i.error((null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||a.message||"操作失败，请稍后重试")}finally{u.value=!1}})),P=()=>{p.value={transaction_date:"",stock_code:"",stock_name:"",transaction_code:"",transaction_type:"",details:[{quantity:null,price:null}],broker_fee:"",transaction_levy:"",stamp_duty:"",trading_fee:"",deposit_fee:"",market:"HK"},f.value={},m.value=!1};C((()=>{M((()=>{console.log("检查所有输入框的 ref 是否绑定成功:",{transaction_date:k.transaction_date.value,stock_code:k.stock_code.value,transaction_code:k.transaction_code.value,transaction_type:k.transaction_type.value,broker_fee:k.broker_fee.value,transaction_levy:k.transaction_levy.value,stamp_duty:k.stamp_duty.value,trading_fee:k.trading_fee.value,deposit_fee:k.deposit_fee.value,cancelBtn:k.cancelBtn.value,saveBtn:k.saveBtn.value,saveAndAddBtn:k.saveAndAddBtn.value,addDetailBtn:k.addDetailBtn.value,quantityRefs:k.quantityRefs,priceRefs:k.priceRefs}),console.log("动态数组长度检查:",{details_length:p.value.details.length,quantityRefs_length:k.quantityRefs.length,priceRefs_length:k.priceRefs.length});const e=document.querySelectorAll("input:not([disabled]), button:not([disabled])");console.log("可聚焦元素数量:",e.length),p.value.details.forEach(((e,t)=>{console.log(`第 ${t+1} 行明细的ref:`,{quantity:k.quantityRefs[t],price:k.priceRefs[t]})}))})),document.addEventListener("click",j);const e=()=>{try{if(g.value){const e=I.getInstance(g.value);e&&e.dispose(),R=new I(g.value,{backdrop:"static",keyboard:!0}),g.value.addEventListener("hidden.bs.modal",t)}}catch(e){console.error("初始化模态框失败:",e)}},t=()=>{document.querySelectorAll(".modal-backdrop").forEach((e=>{e.classList.remove("show"),setTimeout((()=>e.remove()),150)})),document.body.classList.remove("modal-open"),document.body.style.overflow="",document.body.style.paddingRight="",w.value={market:"HK",code:"",name:"",full_name:"",current_price:null,alertMessage:""}};setTimeout(e,500),window.addEventListener("load",e)})),D((()=>{document.removeEventListener("click",j),g.value&&g.value.removeEventListener("hidden.bs.modal",cleanupModalEffects),R&&R.dispose(),window.removeEventListener("load",initModal)}));x((()=>p.value.details.length),(e=>{M((()=>{k.quantityRefs||(k.quantityRefs=[]),k.priceRefs||(k.priceRefs=[]),k.quantityRefs.length=e,k.priceRefs.length=e;for(let t=0;t<e;t++)k.quantityRefs[t]||(k.quantityRefs[t]=null),k.priceRefs[t]||(k.priceRefs[t]=null)}))}));const O=B.debounce((e=>r(this,null,(function*(){const t=e.target.value.trim();if(m.value&&t!==p.value.stock_code&&(m.value=!1,p.value.stock_name=""),!t)return _.value=!1,void(y.value=[]);try{const e=yield $.get(`/api/stock/stocks/search?query=${encodeURIComponent(t)}`,{params:{timestamp:(new Date).getTime()}});e.data.success&&Array.isArray(e.data.data)?(y.value=e.data.data,_.value=y.value.length>0,b.value=y.value.length>0?0:-1):(y.value=[],_.value=!1)}catch(a){console.error("搜索股票失败:",a),y.value=[],_.value=!1,i.error("搜索股票失败，请重试")}}))),300),j=e=>{!e.target.closest(".position-relative")&&_.value&&(_.value=!1,b.value=-1)};x((()=>p.value.stock_code),(e=>{e||(p.value.stock_name="",p.value.market="HK",m.value=!1)}));const Y=()=>{const e=w.value.code;w.value={market:"",code:e,name:"",google_code:"",current_price:null,alertMessage:""},f.value={}},W={router:d,message:i,submitting:u,saveAndAddNext:v,form:p,stockSelected:m,errors:f,inputRefs:k,showStockList:_,filteredStocks:y,currentStockIndex:b,addStockModal:g,showStockModal:h,newStock:w,submittingStock:S,get stockModalInstance(){return R},set stockModalInstance(e){R=e},addDetail:F,removeDetail:e=>{p.value.details.length>1&&p.value.details.splice(e,1)},isValidDate:V,formatDate:E,handleDateInput:e=>{const t=e.target.value;p.value.transaction_date=t},handleDateBlur:e=>{const t=e.target.value.trim();if(!t)return void(p.value.transaction_date="");let a=null;if(/^\d{1,2}$/.test(t)){const e=t.padStart(2,"0"),o=new Date;a=`${o.getFullYear()}-${(o.getMonth()+1).toString().padStart(2,"0")}-${e}`}else if(/^\d{1,2}-\d{1,2}$/.test(t)){const[e,o]=t.split("-").map((e=>e.padStart(2,"0")));a=`${(new Date).getFullYear()}-${e}-${o}`}else if(/^\d{1,2}-\d{1,2}-\d{2}$/.test(t)){const[e,o,s]=t.split("-").map((e=>e.padStart(2,"0")));a=`20${s}-${e}-${o}`}else{const e=new Date(t);V(e)&&(a=E(e))}a&&V(a)?(p.value.transaction_date=a,delete f.value.transaction_date):f.value.transaction_date="请输入有效的交易日期"},validateForm:L,handleTransactionCodeInput:e=>{const t=e.target.value.toUpperCase();p.value.transaction_code=t,t.startsWith("P")?p.value.transaction_type="buy":t.startsWith("S")&&(p.value.transaction_type="sell")},handleTransactionCodeBlur:e=>r(this,null,(function*(){const t=p.value.transaction_code.trim();if(t)try{(yield $.get(`/api/stock/transactions/check-code?code=${encodeURIComponent(t)}`)).data.exists?(f.value.transaction_code="交易编号已存在，请重新输入",e.target.focus()):delete f.value.transaction_code}catch(a){console.error("检查交易编号失败:",a),i.error("检查交易编号失败，请重试")}})),handleStockSelect:()=>{if(_.value&&y.value.length>0){const e=b.value>=0&&b.value<y.value.length?y.value[b.value]:y.value[0];H(e)}},selectStock:H,submitForm:T,saveAndAdd:()=>{v.value=!0,T()},resetForm:P,setQuantityRef:(e,t)=>{for(k.quantityRefs||(k.quantityRefs=[]);k.quantityRefs.length<=t;)k.quantityRefs.push(null);k.quantityRefs[t]=e},setPriceRef:(e,t)=>{for(k.priceRefs||(k.priceRefs=[]);k.priceRefs.length<=t;)k.priceRefs.push(null);k.priceRefs[t]=e},handleKeyNavigation:(e,t)=>{if("Enter"===e.key){if(e.preventDefault(),t.startsWith("quantity_")){const e=parseInt(t.split("_")[1]),a=k.priceRefs[e];return void(a&&a.focus())}if(t.startsWith("price_")){if(parseInt(t.split("_")[1])===p.value.details.length-1){const e=k.broker_fee.value;e&&e.focus()}return}const a={transaction_date:()=>{var e;return null==(e=k.stock_code.value)?void 0:e.focus()},stock_code:()=>{var e;return null==(e=k.transaction_code.value)?void 0:e.focus()},transaction_code:()=>{const e=k.quantityRefs[0];e&&e.focus()},broker_fee:()=>{var e;return null==(e=k.transaction_levy.value)?void 0:e.focus()},transaction_levy:()=>{var e;return null==(e=k.stamp_duty.value)?void 0:e.focus()},stamp_duty:()=>{var e;return null==(e=k.trading_fee.value)?void 0:e.focus()},trading_fee:()=>{var e;return null==(e=k.deposit_fee.value)?void 0:e.focus()},deposit_fee:()=>{const e=k.saveAndAddBtn.value;e&&e.click()}}[t];a&&a()}if("Tab"===e.key){if(e.preventDefault(),t.startsWith("quantity_")){const e=parseInt(t.split("_")[1]),a=k.priceRefs[e];return void(a&&a.focus())}if(t.startsWith("price_"))return F(),void M((()=>{const e=p.value.details.length-1,t=k.quantityRefs[e];t&&t.focus()}));const a={transaction_date:()=>{var e;return null==(e=k.stock_code.value)?void 0:e.focus()},stock_code:()=>{var e;return null==(e=k.transaction_code.value)?void 0:e.focus()},transaction_code:()=>{const e=k.quantityRefs[0];e&&e.focus()},broker_fee:()=>{var e;return null==(e=k.transaction_levy.value)?void 0:e.focus()},transaction_levy:()=>{var e;return null==(e=k.stamp_duty.value)?void 0:e.focus()},stamp_duty:()=>{var e;return null==(e=k.trading_fee.value)?void 0:e.focus()},trading_fee:()=>{var e;return null==(e=k.deposit_fee.value)?void 0:e.focus()},deposit_fee:()=>{var e;return null==(e=k.cancelBtn.value)?void 0:e.focus()}}[t];a&&a()}},handleStockCodeInput:O,navigateStockList:e=>{_.value&&0!==y.value.length&&(b.value="up"===e?b.value<=0?y.value.length-1:b.value-1:b.value>=y.value.length-1?0:b.value+1)},closeStockList:()=>{_.value=!1,b.value=-1},handleClickOutside:j,handleStockCodeBlur:e=>r(this,null,(function*(){setTimeout((()=>r(this,null,(function*(){if(_.value)return;const e=p.value.stock_code.trim();if(e){if(!m.value||!p.value.stock_name)try{const t=yield $.get(`/api/stock/stocks/search?query=${encodeURIComponent(e)}`,{params:{timestamp:(new Date).getTime()}});if(t.data.success&&Array.isArray(t.data.data)){const a=t.data.data.find((t=>t.code===e));if(a)return p.value.stock_code=a.code,p.value.stock_name=a.name,p.value.market=a.market,void(m.value=!0)}const a=yield $.get(`/api/stock/search_stock?code=${encodeURIComponent(e)}`);if(a.data.success&&a.data.data.length>0){const e=a.data.data[0];w.value={market:"HK"===e.market||"HKG"===e.exchange?"HK":"USA",code:e.code,name:e.code_name||"",google_code:e.query,current_price:e.price,alertMessage:""},h.value=!0}else w.value={market:"HK",code:e,name:"",google_code:"",current_price:null,alertMessage:"未找到股票信息，请手动输入股票详情"},h.value=!0}catch(t){console.error("搜索股票失败:",t),w.value={market:"HK",code:e,name:"",google_code:"",current_price:null,alertMessage:"搜索股票失败，请手动输入股票详情"},h.value=!0}}else m.value=!1}))),200)})),handleNewStockCodeEnter:e=>r(this,null,(function*(){if(e.preventDefault(),w.value.code){f.value={},w.value.alertMessage="";try{const e=yield $.get(`/api/stock/search_stock?code=${encodeURIComponent(w.value.code)}`);if(e.data.success&&e.data.data.length>0){const d=e.data.data[0],i=yield $.get("/api/stock/stocks",{params:{search:d.code}});if(i.data.success&&i.data.data.items.length>0){const e=i.data.data.items.find((e=>e.code===d.code));if(e)return w.value=(r=((e,t)=>{for(var a in t||(t={}))s.call(t,a)&&n(e,a,t[a]);if(o)for(var a of o(t))l.call(t,a)&&n(e,a,t[a]);return e})({},e),c={current_price:d.price},t(r,a(c))),void(m.value=!0)}w.value={code:d.code,market:d.market,name:d.code_name||"",google_code:d.query,current_price:d.price},w.value.name&&(m.value=!0),w.value.name||(f.value.name="未能获取公司名称")}else w.value.alertMessage="未找到股票信息，请检查股票代码是否正确",Y()}catch(d){console.error("查询股票信息失败:",d),w.value.alertMessage="查询失败，请检查股票代码是否正确",Y()}var r,c}})),resetNewStockExceptCode:Y,submitNewStock:()=>r(this,null,(function*(){var e,t;if(S.value)return;f.value={};let a=!0;if(w.value.code||(f.value.code="请输入股票代码",a=!1),w.value.market||(f.value.market="无法确定股票市场",a=!1),w.value.name||(f.value.name="未能获取股票名称",a=!1),w.value.current_price||(f.value.code="未能获取股票价格，请确认股票代码是否正确",a=!1),a)try{S.value=!0;const e=yield $.get("/api/stock/stocks",{params:{search:w.value.code}});if(e.data.success&&e.data.data.items.length>0){if(e.data.data.items.find((e=>e.code===w.value.code)))return i.warning("该股票代码已存在"),w.value.current_price=null,void(S.value=!1)}const t={code:w.value.code,market:w.value.market,code_name:w.value.name,google_name:w.value.google_code,currency:"HK"===w.value.market?"HKD":"USD"};console.log("提交的股票数据:",t);const a=yield $.post("/api/stock/stocks",t);a.data.success?(i.success("股票添加成功"),p.value.stock_code=w.value.code,p.value.stock_name=w.value.name,p.value.market=w.value.market,m.value=!0,h.value=!1):(i.error(a.data.message||"添加股票失败"),w.value.current_price=null)}catch(o){i.error((null==(t=null==(e=o.response)?void 0:e.data)?void 0:t.message)||o.message||"添加股票失败，请重试"),w.value.current_price=null}finally{S.value=!1}})),handleStockCodeFocus:()=>{m.value||(p.value.stock_code=""),p.value.stock_code&&!m.value&&O({target:{value:p.value.stock_code}})},closeStockModal:()=>{h.value=!1,setTimeout((()=>{m.value||(p.value.stock_code="")}),100)},ref:K,computed:N,watch:x,onMounted:C,nextTick:M,onBeforeUnmount:D,get useRouter(){return q},StockSelector:U,get axios(){return $},get useMessage(){return A},get debounce(){return B.debounce},get Modal(){return I}};return Object.defineProperty(W,"__isScriptSetup",{enumerable:!1,value:!0}),W}},[["render",function(e,t,a,o,s,l){const n=d("permission");return i((u(),v("div",F,[t[46]||(t[46]=p("div",{class:"card-header"},[p("h5",{class:"mb-0","data-testid":"transaction-add-title"},"添加交易记录")],-1)),p("div",V,[p("div",E,[p("div",L,[t[26]||(t[26]=p("label",{class:"form-label","data-testid":"transaction-date-label"},"交易日期",-1)),p("div",H,[i(p("input",{type:"text",class:f(["form-control",{"is-invalid":o.errors.transaction_date}]),"onUpdate:modelValue":t[0]||(t[0]=e=>o.form.transaction_date=e),onBlur:o.handleDateBlur,onKeydown:t[1]||(t[1]=e=>o.handleKeyNavigation(e,"transaction_date")),placeholder:"YYYY-MM-DD",ref:e=>o.inputRefs.transaction_date.value=e,"data-testid":"transaction-date-input"},null,34),[[k,o.form.transaction_date]]),p("div",T,_(o.errors.transaction_date),1)])]),p("div",P,[t[27]||(t[27]=p("label",{class:"form-label","data-testid":"stock-code-label"},"股票代码",-1)),p("div",O,[p("div",j,[i(p("input",{type:"text",class:f(["form-control",{"is-invalid":o.errors.stock_code}]),"onUpdate:modelValue":t[2]||(t[2]=e=>o.form.stock_code=e),ref:e=>o.inputRefs.stock_code.value=e,onInput:t[3]||(t[3]=(...e)=>o.handleStockCodeInput&&o.handleStockCodeInput(...e)),onBlur:o.handleStockCodeBlur,onFocus:o.handleStockCodeFocus,onKeydown:[t[4]||(t[4]=e=>o.handleKeyNavigation(e,"stock_code")),t[5]||(t[5]=b(g((e=>o.navigateStockList("down")),["prevent"]),["down"])),t[6]||(t[6]=b(g((e=>o.navigateStockList("up")),["prevent"]),["up"])),b(g(o.handleStockSelect,["prevent"]),["enter"]),b(o.closeStockList,["esc"])],placeholder:"输入代码或名称搜索","data-testid":"stock-code-input"},null,42,Y),[[k,o.form.stock_code]]),o.form.stock_code&&o.form.stock_name?(u(),v("span",W,[p("span",{class:f(["market-tag","HK"===o.form.market?"hk":"usa"]),"data-testid":"selected-stock-market"},_(o.form.market),3),h(" "+_(o.form.stock_code)+" "+_(o.form.stock_name),1)])):y("",!0)]),p("div",Q,_(o.errors.stock_code),1),o.showStockList&&o.filteredStocks.length>0?(u(),v("div",z,[(u(!0),v(w,null,S(o.filteredStocks,((e,t)=>(u(),v("a",{key:e.code,href:"#",class:f(["stock-item",{active:t===o.currentStockIndex}]),onClick:g((t=>o.selectStock(e)),["prevent"]),onMouseover:e=>o.currentStockIndex=t,"data-testid":"stock-item-"+e.code},[p("span",{class:f(["market-tag","HK"===e.market?"hk":"usa"])},_(e.market),3),h(" "+_(e.code)+" - "+_(e.name),1)],42,G)))),128))])):y("",!0)])]),p("div",J,[t[28]||(t[28]=p("label",{class:"form-label","data-testid":"transaction-code-label"},"交易编号",-1)),i(p("input",{type:"text",class:f(["form-control",{"is-invalid":o.errors.transaction_code}]),"onUpdate:modelValue":t[7]||(t[7]=e=>o.form.transaction_code=e),ref:e=>o.inputRefs.transaction_code.value=e,onInput:o.handleTransactionCodeInput,onBlur:o.handleTransactionCodeBlur,onKeydown:t[8]||(t[8]=e=>o.handleKeyNavigation(e,"transaction_code")),"data-testid":"transaction-code-input"},null,34),[[k,o.form.transaction_code]]),p("div",X,_(o.errors.transaction_code),1)])]),p("div",Z,[p("div",ee,[t[29]||(t[29]=p("label",{class:"form-label","data-testid":"transaction-type-label"},"交易类型",-1)),i(p("input",{type:"text",class:f(["form-control",{"is-invalid":o.errors.transaction_type}]),"onUpdate:modelValue":t[9]||(t[9]=e=>o.form.transaction_type=e),ref:e=>o.inputRefs.transaction_type.value=e,onKeydown:t[10]||(t[10]=e=>o.handleKeyNavigation(e,"transaction_type")),placeholder:"P-买入 S-卖出","data-testid":"transaction-type-input"},null,34),[[k,o.form.transaction_type]]),p("div",te,_(o.errors.transaction_type),1)])]),p("div",ae,[p("div",oe,[t[30]||(t[30]=p("label",{class:"form-label mb-0","data-testid":"transaction-details-label"},"成交明细",-1)),p("button",{type:"button",class:"btn btn-sm btn-outline-primary",onClick:o.addDetail,ref:e=>o.inputRefs.addDetailBtn.value=e,"data-testid":"add-detail-button"}," 添加成交记录 ",512)]),p("div",se,[(u(!0),v(w,null,S(o.form.details,((e,t)=>(u(),v("div",{key:t,class:"row g-2 mb-2","data-testid":"detail-row-"+t},[p("div",ne,[p("label",{class:"form-label","data-testid":"quantity-label-"+t},"数量",8,re),i(p("input",{type:"text",class:"form-control","onUpdate:modelValue":t=>e.quantity=t,ref_for:!0,ref:e=>o.setQuantityRef(e,t),onKeydown:e=>o.handleKeyNavigation(e,`quantity_${t}`),"data-testid":"quantity-input-"+t},null,40,ce),[[k,e.quantity]])]),p("div",de,[p("label",{class:"form-label","data-testid":"price-label-"+t},"价格",8,ie),i(p("input",{type:"text",class:f(["form-control",{"is-invalid":o.errors[`price_${t}`]}]),"onUpdate:modelValue":t=>e.price=t,ref_for:!0,ref:e=>o.setPriceRef(e,t),onKeydown:e=>o.handleKeyNavigation(e,`price_${t}`),"data-testid":"price-input-"+t},null,42,ue),[[k,e.price]]),p("div",{class:"invalid-feedback","data-testid":"price-error-"+t},_(o.errors[`price_${t}`]),9,ve)]),p("div",pe,[p("button",{type:"button",class:"btn btn-outline-danger w-100",onClick:e=>o.removeDetail(t),disabled:1===o.form.details.length,"data-testid":"remove-detail-button-"+t}," 删除 ",8,me)])],8,le)))),128))])]),p("div",fe,[t[36]||(t[36]=p("label",{class:"form-label","data-testid":"fees-label"},"费用明细",-1)),p("div",ke,[p("div",_e,[p("div",ye,[t[31]||(t[31]=p("label",{class:"form-label","data-testid":"broker-fee-label"},"经纪佣金",-1)),i(p("input",{type:"text",class:"form-control","onUpdate:modelValue":t[11]||(t[11]=e=>o.form.broker_fee=e),ref:e=>o.inputRefs.broker_fee.value=e,onKeydown:t[12]||(t[12]=e=>o.handleKeyNavigation(e,"broker_fee")),"data-testid":"broker-fee-input"},null,544),[[k,o.form.broker_fee]])]),p("div",be,[t[32]||(t[32]=p("label",{class:"form-label","data-testid":"transaction-levy-label"},"交易征费",-1)),i(p("input",{type:"text",class:"form-control","onUpdate:modelValue":t[13]||(t[13]=e=>o.form.transaction_levy=e),ref:e=>o.inputRefs.transaction_levy.value=e,onKeydown:t[14]||(t[14]=e=>o.handleKeyNavigation(e,"transaction_levy")),"data-testid":"transaction-levy-input"},null,544),[[k,o.form.transaction_levy]])]),p("div",ge,[t[33]||(t[33]=p("label",{class:"form-label","data-testid":"stamp-duty-label"},"印花税",-1)),i(p("input",{type:"text",class:"form-control","onUpdate:modelValue":t[15]||(t[15]=e=>o.form.stamp_duty=e),ref:e=>o.inputRefs.stamp_duty.value=e,onKeydown:t[16]||(t[16]=e=>o.handleKeyNavigation(e,"stamp_duty")),"data-testid":"stamp-duty-input"},null,544),[[k,o.form.stamp_duty]])]),p("div",he,[t[34]||(t[34]=p("label",{class:"form-label","data-testid":"trading-fee-label"},"交易费",-1)),i(p("input",{type:"text",class:"form-control","onUpdate:modelValue":t[17]||(t[17]=e=>o.form.trading_fee=e),ref:e=>o.inputRefs.trading_fee.value=e,onKeydown:t[18]||(t[18]=e=>o.handleKeyNavigation(e,"trading_fee")),"data-testid":"trading-fee-input"},null,544),[[k,o.form.trading_fee]])]),p("div",we,[t[35]||(t[35]=p("label",{class:"form-label","data-testid":"deposit-fee-label"},"存入证券费",-1)),i(p("input",{type:"text",class:"form-control","onUpdate:modelValue":t[19]||(t[19]=e=>o.form.deposit_fee=e),ref:e=>o.inputRefs.deposit_fee.value=e,onKeydown:t[20]||(t[20]=e=>o.handleKeyNavigation(e,"deposit_fee")),"data-testid":"deposit-fee-input"},null,544),[[k,o.form.deposit_fee]])])])])]),p("div",Se,[p("button",{type:"button",class:"btn btn-secondary",onClick:t[21]||(t[21]=t=>e.$router.back()),ref:e=>o.inputRefs.cancelBtn.value=e,"data-testid":"cancel-button"}," 取消 ",512),p("button",{type:"button",class:"btn btn-primary",disabled:o.submitting,ref:e=>o.inputRefs.saveBtn.value=e,onClick:o.submitForm,"data-testid":"save-button"},[o.submitting?(u(),v("span",qe)):y("",!0),t[37]||(t[37]=h(" 保存 "))],8,Re),p("button",{type:"button",class:"btn btn-success",disabled:o.submitting,onClick:o.saveAndAdd,ref:e=>o.inputRefs.saveAndAddBtn.value=e,"data-testid":"save-and-add-button"},[o.submitting?(u(),v("span",xe)):y("",!0),t[38]||(t[38]=h(" 保存并添加下一条 "))],8,Ke)])]),(u(),m(R,{to:"body"},[o.showStockModal?(u(),v("div",{key:0,class:"stock-modal-backdrop",onClick:g(o.closeStockModal,["self"])},[p("div",Ce,[p("div",{class:"stock-modal-header"},[t[39]||(t[39]=p("h5",{class:"stock-modal-title","data-testid":"add-stock-modal-title"},"添加新股票",-1)),p("button",{type:"button",class:"stock-modal-close",onClick:o.closeStockModal},"×")]),p("div",Me,[p("form",{onSubmit:g(o.submitNewStock,["prevent"])},[p("div",De,[t[40]||(t[40]=p("label",{class:"form-label","data-testid":"new-stock-code-label"},"股票代码",-1)),i(p("input",{type:"text",class:f(["form-control",{"is-invalid":o.errors.code}]),"onUpdate:modelValue":t[22]||(t[22]=e=>o.newStock.code=e),placeholder:"输入股票代码后将自动查询股票信息",onKeydown:b(g(o.handleNewStockCodeEnter,["prevent"]),["enter"]),"data-testid":"new-stock-code-input"},null,42,Be),[[k,o.newStock.code]]),p("div",$e,_(o.errors.code),1)]),p("div",Ae,[t[41]||(t[41]=p("label",{class:"form-label","data-testid":"new-stock-market-label"},"市场",-1)),i(p("input",{type:"text",class:f(["form-control",{"is-invalid":o.errors.market}]),"onUpdate:modelValue":t[23]||(t[23]=e=>o.newStock.market=e),readonly:"","data-testid":"new-stock-market-input"},null,2),[[k,o.newStock.market]]),p("div",Ue,_(o.errors.market),1)]),p("div",Ne,[t[42]||(t[42]=p("label",{class:"form-label","data-testid":"new-stock-name-label"},"股票名称",-1)),i(p("input",{type:"text",class:f(["form-control",{"is-invalid":o.errors.name}]),"onUpdate:modelValue":t[24]||(t[24]=e=>o.newStock.name=e),readonly:"","data-testid":"new-stock-name-input"},null,2),[[k,o.newStock.name]]),p("div",Ie,_(o.errors.name),1)]),p("div",Fe,[t[43]||(t[43]=p("label",{class:"form-label","data-testid":"new-stock-google-code-label"},"谷歌查询代码",-1)),i(p("input",{type:"text",class:"form-control","onUpdate:modelValue":t[25]||(t[25]=e=>o.newStock.google_code=e),readonly:"","data-testid":"new-stock-google-code-input"},null,512),[[k,o.newStock.google_code]])]),p("div",Ve,[t[44]||(t[44]=p("label",{class:"form-label","data-testid":"new-stock-price-label"},"当前股价",-1)),p("input",{type:"text",class:"form-control",value:o.newStock.current_price,readonly:"","data-testid":"new-stock-price-input"},null,8,Ee),o.newStock.alertMessage?(u(),v("div",{key:0,class:f({"text-danger":o.newStock.alertMessage.includes("已存在"),"text-primary":o.newStock.alertMessage.includes("查询失败")}),"data-testid":"new-stock-alert-message"},_(o.newStock.alertMessage),3)):y("",!0)])],32)]),p("div",Le,[p("button",{type:"button",class:"btn-secondary",onClick:o.closeStockModal,"data-testid":"add-stock-modal-cancel"},"取消"),p("button",{type:"button",class:"btn-primary",onClick:o.submitNewStock,disabled:o.submittingStock,"data-testid":"add-stock-modal-submit"},[o.submittingStock?(u(),v("span",Te)):y("",!0),t[45]||(t[45]=h(" 确认添加 "))],8,He)])])])):y("",!0)]))])),[[n,"transaction:records:add"]])}],["__scopeId","data-v-b219d5a9"],["__file","TransactionAdd.vue"]]);export{Pe as default};
